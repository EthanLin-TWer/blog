---
title: JavaScript åŸå‹ç»§æ‰¿ä¹‹ç²¾é«“
---

ä¸€ç¯‡æ–‡ç« è®©ä½ ææ¸…æ¥š JavaScript ç»§æ‰¿ã€`prototype`ã€`__proto__`ã€`constructor` éƒ½æ˜¯ä»€ä¹ˆã€‚

å¾ˆå¤šå°ä¼™ä¼´è¡¨ç¤ºä¸æ˜ç™½ JavaScript çš„ç»§æ‰¿ï¼Œè¯´æ˜¯åŸå‹é“¾ï¼Œçœ‹èµ·æ¥åˆåƒç±»ï¼Œç©¶ç«Ÿæ˜¯åŸå‹è¿˜æ˜¯ç±»ï¼Ÿå„ç§ `prototype`ã€`__proto__`ã€`constructor` å†…éƒ¨å˜é‡æ›´æ˜¯å‚»å‚»æä¸æ¸…æ¥šã€‚å…¶å®ï¼Œåªè¦æ˜ç™½ç»§æ‰¿çš„æœ¬è´¨å°±å¾ˆèƒ½ç†è§£ï¼Œç»§æ‰¿æ˜¯ä¸ºäº†ä»£ç å¤ç”¨ã€‚å¤ç”¨å¹¶ä¸ä¸€å®šå¾—é€šè¿‡ç±»ï¼ŒJS å°±é‡‡ç”¨äº†ä¸€ç§è½»é‡ç®€æ˜çš„åŸå‹æ–¹æ¡ˆæ¥å®ç°ã€‚æ‰€ä»¥çœŸç›¸æ˜¯ï¼ŒJS çš„ç»§æ‰¿è·Ÿç±»å®Œå…¨æ²¡æœ‰åŠæ¯›é’±å…³ç³»ã€‚

## ç›®å½•

* ç»§æ‰¿æ–¹æ¡ˆçš„è®¾è®¡è¦æ±‚
* è¢«å¤ç”¨çš„å¯¹è±¡ï¼š`prototype`
* ä¼˜é›…çš„ APIï¼šES6 `class`
* ç®€æ˜çš„å‘ä¸ŠæŸ¥æ‰¾æœºåˆ¶ï¼š`__proto__`
* å‚è€ƒ

## ç»§æ‰¿æ–¹æ¡ˆçš„è®¾è®¡è¦æ±‚

å‰é¢æˆ‘ä»¬è®²ï¼Œç»§æ‰¿çš„æœ¬è´¨æ˜¯ä¸ºäº†æ›´å¥½åœ°å®ç°ä»£ç å¤ç”¨ã€‚å†ä»”ç»†æ€è€ƒï¼Œå¯ä»¥å‘ç°ï¼Œè¿™é‡Œçš„ã€Œä»£ç ã€æŒ‡çš„ä¸€å®šæ˜¯ã€Œæ•°æ®+è¡Œä¸ºã€çš„å¤ç”¨ï¼Œä¹Ÿå°±æ˜¯æŠŠä¸€ç»„æ•°æ®å’Œæ•°æ®ç›¸å…³çš„è¡Œä¸ºè¿›è¡Œå°è£…ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºï¼Œå¦‚æœåªæ˜¯å¤ç”¨è¡Œä¸ºï¼Œé‚£ä¹ˆä½¿ç”¨å‡½æ•°å°±è¶³å¤Ÿäº†ï¼›è€Œå¦‚æœåªæ˜¯å¤ç”¨æ•°æ®ï¼Œè¿™ä½¿ç”¨ JavaScript å¯¹è±¡å°±å¯ä»¥äº†ï¼š

```javascript
const parent = {
  some: 'data',
}
const child = {
  ...parent,
  uniq: 'data',
}
```

å› æ­¤ï¼Œåªæœ‰æ•°æ®+è¡Œä¸ºï¼ˆå·²ç»ç±»ä¼¼äºä¸€ä¸ªã€Œå¯¹è±¡ã€çš„æ¦‚å¿µï¼‰çš„å°è£…ï¼Œæ‰æ˜¯ç»§æ‰¿æŠ€æœ¯æ‰€å¿…é¡»å‡ºç°çš„åœ°æ–¹ã€‚ä¸ºäº†æ»¡è¶³è¿™æ ·çš„ä»£ç å¤ç”¨ï¼Œä¸€ä¸ªç»§æ‰¿ä½“ç³»çš„è®¾è®¡éœ€è¦æ”¯æŒä»€ä¹ˆéœ€æ±‚å‘¢ï¼Ÿ

* å­˜å‚¨å…¬ç”¨çš„æ•°æ®å’Œå‡½æ•°
* è¦†ç›–è¢«ç»§æ‰¿å¯¹è±¡æ•°æ®æˆ–å‡½æ•°çš„èƒ½åŠ›
* å‘ä¸ŠæŸ¥æ‰¾/è°ƒç”¨è¢«ç»§æ‰¿å¯¹è±¡å‡½æ•°çš„æ•°æ®æˆ–å‡½æ•°çš„èƒ½åŠ›
* ä¼˜é›…çš„è¯­æ³•ï¼ˆAPIï¼‰
* å¢åŠ æ–°æˆå‘˜çš„èƒ½åŠ›
* æ”¯æŒç§æœ‰æ•°æ®

ã€Œæ”¯æŒç§æœ‰æ•°æ®ã€ï¼Œè¿™ä¸ªåŸºæœ¬æ‰€æœ‰æ–¹æ¡ˆéƒ½æ²¡å®ç°ï¼Œæ­¤é˜¶æ®µæˆ‘ä»¬å¯ä»¥ä¸ç”¨çº ç»“ï¼›è€Œã€Œå¢åŠ æ–°æˆå‘˜çš„èƒ½åŠ›ã€ï¼ŒåŸºæœ¬æ‰€æœ‰çš„æ–¹æ¡ˆéƒ½èƒ½åšåˆ°ï¼Œä¹Ÿä¸å†èµ˜è¿°ï¼Œä¸»è¦æ¥çœ‹å‰å››ç‚¹ã€‚

## è¢«å¤ç”¨çš„å¯¹è±¡ï¼š`prototype`

JavaScript çš„ç»§æ‰¿æœ‰å¤šç§å®ç°æ–¹å¼ï¼Œå…·ä½“æœ‰å“ªäº›ï¼Œæ¨èè¯»è€…å¯é˜…è¯»ï¼š[JavaScript è¯­è¨€ç²¾ç²¹][]ä¸€ä¹¦ å’Œ [è¿™ç¯‡æ–‡ç« ](https://github.com/mqyqingfeng/Blog/issues/16)ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬ç›´æ¥çœ‹ä¸€ç‰ˆæ¯”è¾ƒä¼˜ç§€çš„å®ç°ï¼š

```javascript
function Animal(name) {
  this.name = name
  this.getName = function() {
    return this.name
  }
}

function Cat(name, age) {
  Animal.call(this, name)
  this.age = age || 1
  this.meow = function() {
    return `${this.getName()}eowww~~~~~, I'm ${this.age} year(s) old`
  }
}

const cat = new Cat('Lily', 2)
console.log(cat.meow()) // 'Lilyeowww~~~~~, I'm 2 year(s) old'
```

è¿™ä¸ªæ–¹æ¡ˆï¼Œå…·å¤‡å¢æ·»æ–°æˆå‘˜çš„èƒ½åŠ›ã€è°ƒç”¨è¢«ç»§æ‰¿å¯¹è±¡å‡½æ•°çš„èƒ½åŠ›ç­‰ã€‚ä¸€ä¸ªæ¯”è¾ƒé‡å¤§çš„ç¼ºé™·æ˜¯ï¼šå¯¹è±¡çš„æ‰€æœ‰æ–¹æ³• `getName` `meow`ï¼Œéƒ½ä¼šéšæ¯ä¸ªå®ä¾‹ç”Ÿæˆä¸€ä»½æ–°çš„æ‹·è´ã€‚è¿™æ˜¾ç„¶ä¸æ˜¯ä¼˜ç§€çš„è®¾è®¡æ–¹æ¡ˆï¼Œæˆ‘ä»¬æœŸæœ›çš„ç»“æœæ˜¯ï¼Œç»§æ‰¿è‡ªåŒä¸€å¯¹è±¡çš„å­å¯¹è±¡ï¼Œå…¶æ‰€æœ‰çš„æ–¹æ³•éƒ½å…±äº«è‡ªåŒä¸€ä¸ªå‡½æ•°å®ä¾‹ã€‚

æ€ä¹ˆåŠå‘¢ï¼Ÿæƒ³æ³•ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯æŠŠå®ƒä»¬æ”¾åˆ°åŒä¸€ä¸ªåœ°æ–¹å»ï¼Œå¹¶ä¸”è¿˜è¦è·Ÿè¿™ä¸ªã€Œå¯¹è±¡ã€å…³è”èµ·æ¥ã€‚å¦‚æ­¤ä¸€æƒ³ï¼Œç”¨æ¥ç”Ÿæˆè¿™ä¸ªã€Œå¯¹è±¡ã€çš„å‡½æ•°æœ¬èº«å°±æ˜¯å¾ˆå¥½çš„åœ°æ–¹ã€‚æˆ‘ä»¬å¯ä»¥æŠŠå®ƒæ”¾åœ¨å‡½æ•°çš„ä»»ä¸€ä¸€ä¸ªå˜é‡ä¸Šï¼Œæ¯”å¦‚ï¼š

```javascript
Animal.functions.getName = function() {
  return this.name
}
Cat.functions.meow = function() {
  return `${this.getName()}eowww~~~~~, I'm ${this.age} year(s) old`
}
```

ä½†è¿™æ ·è°ƒç”¨èµ·æ¥ï¼Œä½ å°±è¦å†™ `animal.functions.getName()`ï¼Œå¹¶ä¸æ–¹ä¾¿ã€‚ä¸è¦æ€•ï¼ŒJavaScript è¿™é—¨è¯­è¨€æœ¬èº«å·²ç»å¸®ä½ å†…ç½®äº†è¿™æ ·çš„æ”¯æŒã€‚å®ƒå†…éƒ¨æ‰€ç”¨æ¥å­˜å‚¨å…¬å…±å‡½æ•°çš„å˜é‡ï¼Œå°±æ˜¯ä½ ç†ŸçŸ¥çš„ `prototype`ã€‚å½“ä½ è°ƒç”¨å¯¹è±¡ä¸Šçš„æ–¹æ³•æ—¶ï¼ˆå¦‚ `cat.getName()`ï¼‰ï¼Œå®ƒä¼šè‡ªåŠ¨å» `Cat.prototype` ä¸Šå»å¸®ä½ æ‰¾ `getName` å‡½æ•°ï¼Œè€Œä½ åªéœ€è¦å†™ `cat.getName()` å³å¯ã€‚å…¼å…·äº†åŠŸèƒ½çš„å®ç°å’Œè¯­æ³•çš„ä¼˜é›…ã€‚

æœ€åå†™å‡ºæ¥çš„ä»£ç ä¼šæ˜¯è¿™æ ·ï¼š

```javascript
function Animal(name) {
  this.name = name
}
Animal.prototype.getName = function() {
  return this.name
}

function Cat(name, age) {
  Animal.call(this, name)
  this.age = age || 1
}
Cat.prototype.meow = function() {
  return `${this.getName()}eowww~~~~~, I'm ${this.age} year(s) old`
}
```

## ä¼˜é›…çš„ APIï¼šES6 `class`

ç„¶é¹…ï¼Œä¸Šé¢è¿™ä¸ªå†™æ³•ä»ç„¶å¹¶ä¸ä¼˜é›…ã€‚åœ¨ä½•å¤„å‘¢ï¼Ÿä¸€ä¸ªæ˜¯ `prototype` è¿™ç§æš´éœ²è¯­è¨€å®ç°æœºåˆ¶çš„å…³é”®è¯ï¼›ä¸€ä¸ªæ˜¯è¦å‘½çš„æ˜¯ï¼Œè¿™ä¸ªå‡½æ•°å†…éƒ¨çš„ `this`ï¼Œä¾é çš„æ˜¯ä½œä¸ºä½¿ç”¨è€…çš„ä½ è®°å¾—ä½¿ç”¨ `new` æ“ä½œç¬¦å»è°ƒç”¨å®ƒæ‰èƒ½å¾—åˆ°æ­£ç¡®çš„åˆå§‹åŒ–ï¼ˆå…·ä½“åŸå› è¯·å‚è§ã€å¾…è¡¥å……ã€‘ï¼‰ã€‚ä½†æ˜¯è¿™é‡Œæ²¡æœ‰ä»»ä½•çº¿ç´¢å‘Šè¯‰ä½ ï¼Œåº”è¯¥ä½¿ç”¨ `new` å»è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œä¸€æ—¦ä½ å¿˜è®°äº†ï¼Œä¹Ÿä¸ä¼šæœ‰ä»»ä½•ç¼–è¯‘æœŸå’Œè¿è¡ŒæœŸçš„é”™è¯¯ä¿¡æ¯ã€‚è¿™æ ·çš„è¯­è¨€ç‰¹æ€§ï¼Œä¸å…¶è¯´æ˜¯ä¸€ä¸ªã€Œç»§æ‰¿æ–¹æ¡ˆã€ï¼Œä¸å¦‚è¯´æ˜¯ä¸€ä¸ª bugï¼Œä¸€ä¸ªä¸åº”å‡ºç°çš„è®¾è®¡å¤±è¯¯ã€‚

è€Œè¿™ä¸¤ä¸ªé—®é¢˜ï¼Œåœ¨ ES6 æä¾›çš„ `class` å…³é”®è¯ä¸‹ï¼Œå·²ç»å¾—åˆ°äº†éå¸¸å¦¥å–„çš„è§£å†³ï¼Œå°½ç®¡å®ƒå«ä¸€ä¸ª classï¼Œä½†æœ¬è´¨ä¸Šå…¶å®æ˜¯é€šè¿‡ prototype å®ç°çš„ï¼š

```javascript
class Animal {
  constructor(name) {
    this.name = name
  }

  getName() {
    return this.name
  }
}

class Cat extends Animal {
  constructor(name, age) {
    super(name)
    this.age = age || 1
  }

  meow() {
    return `${this.getName()}eowww~~~~~, I'm ${this.age} year(s) old`
  }
}
```

* å¦‚æœä½ æ²¡æœ‰ä½¿ç”¨ `new` æ“ä½œç¬¦ï¼Œç¼–è¯‘å™¨å’Œè¿è¡Œæ—¶éƒ½ä¼šç›´æ¥æŠ¥é”™ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹ä¸€ç¯‡æ–‡ç« è®²è§£
* `extends` å…³é”®å­—ï¼Œä¼šä½¿è§£é‡Šå™¨ç›´æ¥åœ¨åº•ä¸‹å®ŒæˆåŸºäºåŸå‹çš„ç»§æ‰¿åŠŸèƒ½

ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†ä¸€å¥—æ¯”è¾ƒå®Œç¾çš„ç»§æ‰¿ APIï¼Œä¹Ÿçœ‹åˆ°å…¶åº•ä¸‹ä½¿ç”¨ `prototype` å­˜å‚¨å…¬å…±å˜é‡çš„åœ°ç‚¹å’ŒåŸç†ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦è§£å†³å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼š`prototype` æœ‰äº†ï¼Œå®ä¾‹å¯¹è±¡åº”è¯¥å¦‚ä½•è®¿é—®åˆ°å®ƒå‘¢ï¼Ÿè¿™å°±å…³ç³»åˆ° JavaScript çš„å‘ä¸ŠæŸ¥æ‰¾æœºåˆ¶äº†ã€‚

## ç®€æ˜çš„å‘ä¸ŠæŸ¥æ‰¾æœºåˆ¶ï¼š`__proto__`

```javascript
function Animal(name) {
  this.name = name
}
Animal.prototype.say = function() {
  return this.name
}
const cat = new Animal('kitty')

console.log(cat) // Animal { name: 'kitty' }
cat.hasOwnProperty('say') // false
```

çœ‹ä¸Šé¢ ğŸ‘† ä¸€ä¸ªæœ€ç®€å•çš„ä¾‹å­ã€‚æ‰“å‡ºæ¥çš„ `cat` å¯¹è±¡æœ¬èº«å¹¶æ²¡æœ‰ `say` æ–¹æ³•ã€‚é‚£ä¹ˆï¼Œè¢«å®ä¾‹åŒ–çš„ `cat` å¯¹è±¡æœ¬èº«ï¼Œæ˜¯æ€æ ·å‘ä¸ŠæŸ¥æ‰¾åˆ° `Animal.prototype` ä¸Šçš„ `say` æ–¹æ³•çš„å‘¢ï¼Ÿå¦‚æœä½ æ˜¯ JavaScript å¼•æ“çš„è®¾è®¡è€…ï¼Œä½ ä¼šæ€æ ·æ¥å®ç°å‘¢ï¼Ÿ

æˆ‘æ‹è„‘è¢‹è¿™ä¹ˆä¸€æƒ³ï¼Œæœ‰å‡ ç§æ–¹æ¡ˆï¼š

* åœ¨ `Animal` ä¸­åˆå§‹åŒ–å®ä¾‹å¯¹è±¡ `cat` æ—¶ï¼Œé¡ºä¾¿å­˜å–ä¸€ä¸ªæŒ‡å‘ `Animal.prototype` çš„å¼•ç”¨
* åœ¨ `Animal` ä¸­åˆå§‹åŒ–å®ä¾‹å¯¹è±¡æ—¶ï¼Œè®°å½•å…¶ã€Œç±»å‹ã€ï¼ˆä¹Ÿå³æ˜¯ `Animal`ï¼‰

```javascript
// æ–¹æ¡ˆ1
function Animal(name) {
  this.name = name
  // ä»¥ä¸‹ä»£ç ç”±å¼•æ“è‡ªåŠ¨åŠ å…¥
  this.__prototype__ = Animal.prototype
}

const cat = new Animal('kitty')
cat.say() // -> cat.__prototype__.say()

// æ–¹æ¡ˆ2
function Animal(name) {
  this.name = name
  // ä»¥ä¸‹ä»£ç ç”±å¼•æ“è‡ªåŠ¨åŠ å…¥
  this.__type__ = Animal
}

const cat = new Animal('kitty')
cat.say() // -> cat.__type__.prototype.say()
```

ç©¶å…¶å®è´¨ï¼Œå…¶å®å°±æ˜¯ï¼š**å®ä¾‹å¯¹è±¡éœ€è¦ä¸€ä¸ªæŒ‡å‘å…¶å‡½æ•°çš„å¼•ç”¨ï¼ˆå˜é‡ï¼‰**ï¼Œä»¥æ‹¿åˆ°è¿™ä¸ªå…¬å…±åŸå‹ `prototype` æ¥å®ç°ç»§æ‰¿æ–¹æ¡ˆçš„å‘ä¸ŠæŸ¥æ‰¾èƒ½åŠ›ã€‚è¯»è€…å¦‚æœæœ‰å…¶ä»–æ–¹æ¡ˆï¼Œä¸å¦¨ç•™è¨€è®¨è®ºã€‚

æ— ç‹¬æœ‰å¶ï¼Œè¿™ä¸¤ç§æ–¹æ¡ˆï¼Œåœ¨ JavaScript ä¸­éƒ½æœ‰å®ç°ï¼Œåªä¸è¿‡å˜é‡çš„å‘½åä¸æˆ‘ä»¬çš„å–æ³•æœ‰æ‰€å·®å¼‚ï¼šç¬¬ä¸€ç§æ–¹æ¡ˆä¸­ï¼Œå®é™…çš„å˜é‡åå« `__proto__` è€Œä¸æ˜¯ `__prototype__`ï¼›ç¬¬äºŒç§æ–¹æ¡ˆä¸­ï¼Œå®é™…çš„å˜é‡åå« `constructor`ï¼Œä¸å«~~ä¿—æ°”çš„~~ `__type__`ã€‚å®é™…ä¸Šï¼Œç”¨æ¥å®ç°ç»§æ‰¿ã€åšå‘ä¸ŠæŸ¥æ‰¾çš„è¿™ä¸ªå¼•ç”¨ï¼Œæ­£æ˜¯ `__proto__`ï¼›è‡³äº constructorï¼Œåˆ™å¦æœ‰ä»–ç”¨ã€‚ä¸è¿‡è¦æ³¨æ„çš„æ˜¯ï¼Œ[å°½ç®¡åŸºæœ¬æ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒ `__proto__`][mdn `__proto__`]ï¼Œå®ƒå¹¶ä¸æ˜¯è§„èŒƒçš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤å¹¶ä¸æ¨èåœ¨ä½ çš„ä¸šåŠ¡ä»£ç ä¸­ç›´æ¥ä½¿ç”¨ `__proto__` è¿™ä¸ªå˜é‡ã€‚

![JavaScript Prototypal Inheritance](https://user-images.githubusercontent.com/11895199/47256895-7a423e00-d4b9-11e8-93a7-076259912244.png)

ä»ä¸Šå›¾å¯ä»¥æ¸…æ¥šçœ‹åˆ°ï¼Œ`prototype` æ˜¯ç”¨æ¥å­˜å‚¨ç±»å‹å…¬å…±æ–¹æ³•çš„ä¸€ä¸ªå¯¹è±¡ï¼ˆæ­£å› æ­¤æ¯ä¸ªç±»å‹æœ‰å®ƒåŸºæœ¬çš„æ–¹æ³•ï¼‰ï¼Œè€Œ `__proto__` æ˜¯ç”¨æ¥å®ç°å‘ä¸ŠæŸ¥æ‰¾çš„ä¸€ä¸ªå¼•ç”¨ã€‚ä»»ä½•å¯¹è±¡éƒ½ä¼šæœ‰ `__proto__`ã€‚`Object.prototype` çš„ `__proto__` æ˜¯ nullï¼Œä¹Ÿå³æ˜¯åŸå‹é“¾çš„ç»ˆç‚¹ã€‚

* https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Details_of_the_Object_Model
* https://developer.mozilla.org/en-US/docs/Web/JavaScript/Inheritance_and_the_prototype_chain
* https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Objects/Inheritance

## å‚è€ƒ

* [JavaScript æ·±å…¥ä¹‹ç»§æ‰¿çš„å¤šç§æ–¹æ³•](https://github.com/mqyqingfeng/Blog/issues/16)
* [ä¸€å¼ å›¾ç†è§£ JS çš„åŸå‹](https://juejin.im/post/5b729c24f265da280f3ad010)
* [Prototypal Inheritance in JavaScript](http://crockford.com/javascript/prototypal.html)
* [How Prototypal Inheritance really works](http://blog.vjeux.com/2011/javascript/how-prototypal-inheritance-really-works.html)
* [MDN `__proto__`][]

## TODOLIST

* è¡¥å…¨ã€Œæ„é€ å‡½æ•°è°ƒç”¨éœ€è¦ `new` æ“ä½œç¬¦ã€çš„è¿æ¥ææ–™ï¼š

[javascript è¯­è¨€ç²¾ç²¹]: https://book.douban.com/subject/3590768/
[MDN `__proto__`]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/proto
