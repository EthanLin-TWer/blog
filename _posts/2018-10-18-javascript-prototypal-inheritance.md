---
title: JavaScript åŸå‹ç»§æ‰¿ä¹‹ç²¾é«“
---

ä¸€ç¯‡æ–‡ç« è®©ä½ ææ¸…æ¥š JavaScript ç»§æ‰¿çš„æœ¬è´¨ã€`prototype`ã€`__proto__`ã€`constructor` éƒ½æ˜¯ä»€ä¹ˆã€‚

å¾ˆå¤šå°ä¼™ä¼´è¡¨ç¤ºä¸æ˜ç™½ JavaScript çš„ç»§æ‰¿ï¼Œè¯´æ˜¯åŸå‹é“¾ï¼Œçœ‹èµ·æ¥åˆåƒç±»ï¼Œç©¶ç«Ÿæ˜¯åŸå‹è¿˜æ˜¯ç±»ï¼Ÿå„ç§ `prototype`ã€`__proto__`ã€`constructor` å†…éƒ¨å˜é‡æ›´æ˜¯å‚»å‚»æä¸æ¸…æ¥šã€‚å…¶å®ï¼Œåªè¦æ˜ç™½ç»§æ‰¿çš„æœ¬è´¨å°±å¾ˆèƒ½ç†è§£ï¼Œç»§æ‰¿æ˜¯ä¸ºäº†ä»£ç å¤ç”¨ã€‚å¤ç”¨å¹¶ä¸ä¸€å®šå¾—é€šè¿‡ç±»ï¼ŒJS å°±é‡‡ç”¨äº†ä¸€ç§è½»é‡ç®€æ˜çš„åŸå‹æ–¹æ¡ˆæ¥å®ç°ã€‚Java/C++ ç­‰å¼ºç±»å‹è¯­è¨€ä¸­æœ‰ç±»å’Œå¯¹è±¡çš„åŒºåˆ«ï¼Œä½† JS åªæœ‰å¯¹è±¡ã€‚å®ƒçš„åŸå‹ä¹Ÿæ˜¯å¯¹è±¡ã€‚åªè¦ä½ å®Œå…¨æŠ›å¼€é¢å‘å¯¹è±¡çš„ç»§æ‰¿æ€è·¯æ¥çœ‹ JS çš„åŸå‹ç»§æ‰¿ï¼Œä½ ä¼šå‘ç°å®ƒè½»ä¾¿ä½†å¼ºå¤§ã€‚

## ç›®å½•

* ç»§æ‰¿æ–¹æ¡ˆçš„è®¾è®¡è¦æ±‚
* è¢«å¤ç”¨çš„å¯¹è±¡ï¼š`prototype`
* ä¼˜é›…çš„ APIï¼šES6 `class`
* ç®€æ˜çš„å‘ä¸ŠæŸ¥æ‰¾æœºåˆ¶ï¼š`__proto__`
* æ„é€ å‡½æ•°åˆæ˜¯ä¸ªå•¥ç©æ„å„¿
* åŒé“¾åˆç’§ï¼šç»ˆæå…¨å›¾
* æ€»ç»“
* å‚è€ƒ

## ç»§æ‰¿æ–¹æ¡ˆçš„è®¾è®¡è¦æ±‚

å‰é¢æˆ‘ä»¬è®²ï¼Œç»§æ‰¿çš„æœ¬è´¨æ˜¯ä¸ºäº†æ›´å¥½åœ°å®ç°ä»£ç å¤ç”¨ã€‚å†ä»”ç»†æ€è€ƒï¼Œå¯ä»¥å‘ç°ï¼Œè¿™é‡Œçš„ã€Œä»£ç ã€æŒ‡çš„ä¸€å®šæ˜¯ã€Œæ•°æ®+è¡Œä¸ºã€çš„å¤ç”¨ï¼Œä¹Ÿå°±æ˜¯æŠŠä¸€ç»„æ•°æ®å’Œæ•°æ®ç›¸å…³çš„è¡Œä¸ºè¿›è¡Œå°è£…ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå› ä¸ºï¼Œå¦‚æœåªæ˜¯å¤ç”¨è¡Œä¸ºï¼Œé‚£ä¹ˆä½¿ç”¨å‡½æ•°å°±è¶³å¤Ÿäº†ï¼›è€Œå¦‚æœåªæ˜¯å¤ç”¨æ•°æ®ï¼Œè¿™ä½¿ç”¨ JavaScript å¯¹è±¡å°±å¯ä»¥äº†ï¼š

```javascript
const parent = {
  some: 'data',
}
const child = {
  ...parent,
  uniq: 'data',
}
```

å› æ­¤ï¼Œåªæœ‰æ•°æ®+è¡Œä¸ºï¼ˆå·²ç»ç±»ä¼¼äºä¸€ä¸ªã€Œå¯¹è±¡ã€çš„æ¦‚å¿µï¼‰çš„å°è£…ï¼Œæ‰æ˜¯ç»§æ‰¿æŠ€æœ¯æ‰€å¿…é¡»å‡ºç°çš„åœ°æ–¹ã€‚ä¸ºäº†æ»¡è¶³è¿™æ ·çš„ä»£ç å¤ç”¨ï¼Œä¸€ä¸ªç»§æ‰¿ä½“ç³»çš„è®¾è®¡éœ€è¦æ”¯æŒä»€ä¹ˆéœ€æ±‚å‘¢ï¼Ÿ

* å­˜å‚¨å…¬ç”¨çš„æ•°æ®å’Œå‡½æ•°
* è¦†ç›–è¢«ç»§æ‰¿å¯¹è±¡æ•°æ®æˆ–å‡½æ•°çš„èƒ½åŠ›
* å‘ä¸ŠæŸ¥æ‰¾/è°ƒç”¨è¢«ç»§æ‰¿å¯¹è±¡å‡½æ•°çš„æ•°æ®æˆ–å‡½æ•°çš„èƒ½åŠ›
* ä¼˜é›…çš„è¯­æ³•ï¼ˆAPIï¼‰
* å¢åŠ æ–°æˆå‘˜çš„èƒ½åŠ›
* æ”¯æŒç§æœ‰æ•°æ®

ã€Œæ”¯æŒç§æœ‰æ•°æ®ã€ï¼Œè¿™ä¸ªåŸºæœ¬æ‰€æœ‰æ–¹æ¡ˆéƒ½æ²¡å®ç°ï¼Œæ­¤é˜¶æ®µæˆ‘ä»¬å¯ä»¥ä¸ç”¨çº ç»“ï¼›è€Œã€Œå¢åŠ æ–°æˆå‘˜çš„èƒ½åŠ›ã€ï¼ŒåŸºæœ¬æ‰€æœ‰çš„æ–¹æ¡ˆéƒ½èƒ½åšåˆ°ï¼Œä¹Ÿä¸å†èµ˜è¿°ï¼Œä¸»è¦æ¥çœ‹å‰å››ç‚¹ã€‚

## è¢«å¤ç”¨çš„å¯¹è±¡ï¼š`prototype`

JavaScript çš„ç»§æ‰¿æœ‰å¤šç§å®ç°æ–¹å¼ï¼Œå…·ä½“æœ‰å“ªäº›ï¼Œæ¨èè¯»è€…å¯é˜…è¯»ï¼š[JavaScript è¯­è¨€ç²¾ç²¹][]ä¸€ä¹¦ å’Œ [è¿™ç¯‡æ–‡ç« ](https://github.com/mqyqingfeng/Blog/issues/16)ã€‚è¿™é‡Œï¼Œæˆ‘ä»¬ç›´æ¥çœ‹ä¸€ç‰ˆæ¯”è¾ƒä¼˜ç§€çš„å®ç°ï¼š

```javascript
function Animal(name) {
  this.name = name
  this.getName = function() {
    return this.name
  }
}

function Cat(name, age) {
  Animal.call(this, name)
  this.age = age || 1
  this.meow = function() {
    return `${this.getName()}eowww~~~~~, I'm ${this.age} year(s) old`
  }
}

const cat = new Cat('Lily', 2)
console.log(cat.meow()) // 'Lilyeowww~~~~~, I'm 2 year(s) old'
```

è¿™ä¸ªæ–¹æ¡ˆï¼Œå…·å¤‡å¢æ·»æ–°æˆå‘˜çš„èƒ½åŠ›ã€è°ƒç”¨è¢«ç»§æ‰¿å¯¹è±¡å‡½æ•°çš„èƒ½åŠ›ç­‰ã€‚ä¸€ä¸ªæ¯”è¾ƒé‡å¤§çš„ç¼ºé™·æ˜¯ï¼šå¯¹è±¡çš„æ‰€æœ‰æ–¹æ³• `getName` `meow`ï¼Œéƒ½ä¼šéšæ¯ä¸ªå®ä¾‹ç”Ÿæˆä¸€ä»½æ–°çš„æ‹·è´ã€‚è¿™æ˜¾ç„¶ä¸æ˜¯ä¼˜ç§€çš„è®¾è®¡æ–¹æ¡ˆï¼Œæˆ‘ä»¬æœŸæœ›çš„ç»“æœæ˜¯ï¼Œç»§æ‰¿è‡ªåŒä¸€å¯¹è±¡çš„å­å¯¹è±¡ï¼Œå…¶æ‰€æœ‰çš„æ–¹æ³•éƒ½å…±äº«è‡ªåŒä¸€ä¸ªå‡½æ•°å®ä¾‹ã€‚

æ€ä¹ˆåŠå‘¢ï¼Ÿæƒ³æ³•ä¹Ÿå¾ˆç®€å•ï¼Œå°±æ˜¯æŠŠå®ƒä»¬æ”¾åˆ°åŒä¸€ä¸ªåœ°æ–¹å»ï¼Œå¹¶ä¸”è¿˜è¦è·Ÿè¿™ä¸ªã€Œå¯¹è±¡ã€å…³è”èµ·æ¥ã€‚å¦‚æ­¤ä¸€æƒ³ï¼Œç”¨æ¥ç”Ÿæˆè¿™ä¸ªã€Œå¯¹è±¡ã€çš„å‡½æ•°æœ¬èº«å°±æ˜¯å¾ˆå¥½çš„åœ°æ–¹ã€‚æˆ‘ä»¬å¯ä»¥æŠŠå®ƒæ”¾åœ¨å‡½æ•°çš„ä»»ä¸€ä¸€ä¸ªå˜é‡ä¸Šï¼Œæ¯”å¦‚ï¼š

```javascript
Animal.functions.getName = function() {
  return this.name
}
Cat.functions.meow = function() {
  return `${this.getName()}eowww~~~~~, I'm ${this.age} year(s) old`
}
```

ä½†è¿™æ ·è°ƒç”¨èµ·æ¥ï¼Œä½ å°±è¦å†™ `animal.functions.getName()`ï¼Œå¹¶ä¸æ–¹ä¾¿ã€‚ä¸è¦æ€•ï¼ŒJavaScript è¿™é—¨è¯­è¨€æœ¬èº«å·²ç»å¸®ä½ å†…ç½®äº†è¿™æ ·çš„æ”¯æŒã€‚å®ƒå†…éƒ¨æ‰€ç”¨æ¥å­˜å‚¨å…¬å…±å‡½æ•°çš„å˜é‡ï¼Œå°±æ˜¯ä½ ç†ŸçŸ¥çš„ `prototype`ã€‚å½“ä½ è°ƒç”¨å¯¹è±¡ä¸Šçš„æ–¹æ³•æ—¶ï¼ˆå¦‚ `cat.getName()`ï¼‰ï¼Œå®ƒä¼šè‡ªåŠ¨å» `Cat.prototype` ä¸Šå»å¸®ä½ æ‰¾ `getName` å‡½æ•°ï¼Œè€Œä½ åªéœ€è¦å†™ `cat.getName()` å³å¯ã€‚å…¼å…·äº†åŠŸèƒ½çš„å®ç°å’Œè¯­æ³•çš„ä¼˜é›…ã€‚

æœ€åå†™å‡ºæ¥çš„ä»£ç ä¼šæ˜¯è¿™æ ·ï¼š

```javascript
function Animal(name) {
  this.name = name
}
Animal.prototype.getName = function() {
  return this.name
}

function Cat(name, age) {
  Animal.call(this, name)
  this.age = age || 1
}
Cat.prototype = Object.create(Animal.prototype, { constructor: Cat })
Cat.prototype.meow = function() {
  return `${this.getName()}eowww~~~~~, I'm ${this.age} year(s) old`
}
```

è¯·æ³¨æ„ï¼Œ**åªæœ‰å‡½æ•°æ‰æœ‰ `prototype` å±æ€§**ï¼Œå®ƒæ˜¯ç”¨æ¥åšåŸå‹ç»§æ‰¿çš„å¿…éœ€å“ã€‚

## ä¼˜é›…çš„ APIï¼šES6 `class`

ç„¶é¹…ï¼Œä¸Šé¢è¿™ä¸ªå†™æ³•ä»ç„¶å¹¶ä¸ä¼˜é›…ã€‚åœ¨ä½•å¤„å‘¢ï¼Ÿä¸€ä¸ªæ˜¯ `prototype` è¿™ç§æš´éœ²è¯­è¨€å®ç°æœºåˆ¶çš„å…³é”®è¯ï¼›ä¸€ä¸ªæ˜¯è¦å‘½çš„æ˜¯ï¼Œè¿™ä¸ªå‡½æ•°å†…éƒ¨çš„ `this`ï¼Œä¾é çš„æ˜¯ä½œä¸ºä½¿ç”¨è€…çš„ä½ è®°å¾—ä½¿ç”¨ `new` æ“ä½œç¬¦å»è°ƒç”¨å®ƒæ‰èƒ½å¾—åˆ°æ­£ç¡®çš„åˆå§‹åŒ–ã€‚ä½†æ˜¯è¿™é‡Œæ²¡æœ‰ä»»ä½•çº¿ç´¢å‘Šè¯‰ä½ ï¼Œåº”è¯¥ä½¿ç”¨ `new` å»è°ƒç”¨è¿™ä¸ªå‡½æ•°ï¼Œä¸€æ—¦ä½ å¿˜è®°äº†ï¼Œä¹Ÿä¸ä¼šæœ‰ä»»ä½•ç¼–è¯‘æœŸå’Œè¿è¡ŒæœŸçš„é”™è¯¯ä¿¡æ¯ã€‚è¿™æ ·çš„è¯­è¨€ç‰¹æ€§ï¼Œä¸å…¶è¯´æ˜¯ä¸€ä¸ªã€Œç»§æ‰¿æ–¹æ¡ˆã€ï¼Œä¸å¦‚è¯´æ˜¯ä¸€ä¸ª bugï¼Œä¸€ä¸ªä¸åº”å‡ºç°çš„è®¾è®¡å¤±è¯¯ã€‚

è€Œè¿™ä¸¤ä¸ªé—®é¢˜ï¼Œåœ¨ ES6 æä¾›çš„ `class` å…³é”®è¯ä¸‹ï¼Œå·²ç»å¾—åˆ°äº†éå¸¸å¦¥å–„çš„è§£å†³ï¼Œå°½ç®¡å®ƒå«ä¸€ä¸ª classï¼Œä½†æœ¬è´¨ä¸Šå…¶å®æ˜¯é€šè¿‡ prototype å®ç°çš„ï¼š

```javascript
class Animal {
  constructor(name) {
    this.name = name
  }

  getName() {
    return this.name
  }
}

class Cat extends Animal {
  constructor(name, age) {
    super(name)
    this.age = age || 1
  }

  meow() {
    return `${this.getName()}eowww~~~~~, I'm ${this.age} year(s) old`
  }
}
```

* å¦‚æœä½ æ²¡æœ‰ä½¿ç”¨ `new` æ“ä½œç¬¦ï¼Œç¼–è¯‘å™¨å’Œè¿è¡Œæ—¶éƒ½ä¼šç›´æ¥æŠ¥é”™ã€‚ä¸ºä»€ä¹ˆå‘¢ï¼Œæˆ‘ä»¬å°†åœ¨[ä¸‹ä¸€ç¯‡æ–‡ç« ][]è®²è§£
* `extends` å…³é”®å­—ï¼Œä¼šä½¿è§£é‡Šå™¨ç›´æ¥åœ¨åº•ä¸‹å®ŒæˆåŸºäºåŸå‹çš„ç»§æ‰¿åŠŸèƒ½

ç°åœ¨ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†ä¸€å¥—æ¯”è¾ƒå®Œç¾çš„ç»§æ‰¿ APIï¼Œä¹Ÿçœ‹åˆ°å…¶åº•ä¸‹ä½¿ç”¨ `prototype` å­˜å‚¨å…¬å…±å˜é‡çš„åœ°ç‚¹å’ŒåŸç†ã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬è¦è§£å†³å¦å¤–ä¸€ä¸ªé—®é¢˜ï¼š`prototype` æœ‰äº†ï¼Œå®ä¾‹å¯¹è±¡åº”è¯¥å¦‚ä½•è®¿é—®åˆ°å®ƒå‘¢ï¼Ÿè¿™å°±å…³ç³»åˆ° JavaScript çš„å‘ä¸ŠæŸ¥æ‰¾æœºåˆ¶äº†ã€‚

## ç®€æ˜çš„å‘ä¸ŠæŸ¥æ‰¾æœºåˆ¶ï¼š`__proto__`

```javascript
function Animal(name) {
  this.name = name
}
Animal.prototype.say = function() {
  return this.name
}
const cat = new Animal('kitty')

console.log(cat) // Animal { name: 'kitty' }
cat.hasOwnProperty('say') // false
```

çœ‹ä¸Šé¢ ğŸ‘† ä¸€ä¸ªæœ€ç®€å•çš„ä¾‹å­ã€‚æ‰“å‡ºæ¥çš„ `cat` å¯¹è±¡æœ¬èº«å¹¶æ²¡æœ‰ `say` æ–¹æ³•ã€‚é‚£ä¹ˆï¼Œè¢«å®ä¾‹åŒ–çš„ `cat` å¯¹è±¡æœ¬èº«ï¼Œæ˜¯æ€æ ·å‘ä¸ŠæŸ¥æ‰¾åˆ° `Animal.prototype` ä¸Šçš„ `say` æ–¹æ³•çš„å‘¢ï¼Ÿå¦‚æœä½ æ˜¯ JavaScript å¼•æ“çš„è®¾è®¡è€…ï¼Œä½ ä¼šæ€æ ·æ¥å®ç°å‘¢ï¼Ÿ

æˆ‘æ‹è„‘è¢‹è¿™ä¹ˆä¸€æƒ³ï¼Œæœ‰å‡ ç§æ–¹æ¡ˆï¼š

* åœ¨ `Animal` ä¸­åˆå§‹åŒ–å®ä¾‹å¯¹è±¡ `cat` æ—¶ï¼Œé¡ºä¾¿å­˜å–ä¸€ä¸ªæŒ‡å‘ `Animal.prototype` çš„å¼•ç”¨
* åœ¨ `Animal` ä¸­åˆå§‹åŒ–å®ä¾‹å¯¹è±¡æ—¶ï¼Œè®°å½•å…¶ã€Œç±»å‹ã€ï¼ˆä¹Ÿå³æ˜¯ `Animal`ï¼‰

```javascript
// æ–¹æ¡ˆ1
function Animal(name) {
  this.name = name
  // ä»¥ä¸‹ä»£ç ç”±å¼•æ“è‡ªåŠ¨åŠ å…¥
  this.__prototype__ = Animal.prototype
}

const cat = new Animal('kitty')
cat.say() // -> cat.__prototype__.say()

// æ–¹æ¡ˆ2
function Animal(name) {
  this.name = name
  // ä»¥ä¸‹ä»£ç ç”±å¼•æ“è‡ªåŠ¨åŠ å…¥
  this.__type__ = Animal
}

const cat = new Animal('kitty')
cat.say() // -> cat.__type__.prototype.say()
```

ç©¶å…¶å®è´¨ï¼Œå…¶å®å°±æ˜¯ï¼š**å®ä¾‹å¯¹è±¡éœ€è¦ä¸€ä¸ªæŒ‡å‘å…¶å‡½æ•°çš„å¼•ç”¨ï¼ˆå˜é‡ï¼‰**ï¼Œä»¥æ‹¿åˆ°è¿™ä¸ªå…¬å…±åŸå‹ `prototype` æ¥å®ç°ç»§æ‰¿æ–¹æ¡ˆçš„å‘ä¸ŠæŸ¥æ‰¾èƒ½åŠ›ã€‚è¯»è€…å¦‚æœæœ‰å…¶ä»–æ–¹æ¡ˆï¼Œä¸å¦¨ç•™è¨€è®¨è®ºã€‚

æ— ç‹¬æœ‰å¶ï¼Œè¿™ä¸¤ç§æ–¹æ¡ˆï¼Œåœ¨ JavaScript ä¸­éƒ½æœ‰å®ç°ï¼Œåªä¸è¿‡å˜é‡çš„å‘½åä¸æˆ‘ä»¬çš„å–æ³•æœ‰æ‰€å·®å¼‚ï¼šç¬¬ä¸€ç§æ–¹æ¡ˆä¸­ï¼Œå®é™…çš„å˜é‡åå« `__proto__` è€Œä¸æ˜¯ `__prototype__`ï¼›ç¬¬äºŒç§æ–¹æ¡ˆä¸­ï¼Œå®é™…çš„å˜é‡åå« `constructor`ï¼Œä¸å«~~ä¿—æ°”çš„~~ `__type__`ã€‚å®é™…ä¸Šï¼Œç”¨æ¥å®ç°ç»§æ‰¿ã€åšå‘ä¸ŠæŸ¥æ‰¾çš„è¿™ä¸ªå¼•ç”¨ï¼Œæ­£æ˜¯ `__proto__`ï¼›è‡³äº constructorï¼Œåˆ™å¦æœ‰ä»–ç”¨ã€‚ä¸è¿‡è¦æ³¨æ„çš„æ˜¯ï¼Œ[å°½ç®¡åŸºæœ¬æ‰€æœ‰æµè§ˆå™¨éƒ½æ”¯æŒ `__proto__`][mdn `__proto__`]ï¼Œå®ƒå¹¶ä¸æ˜¯è§„èŒƒçš„ä¸€éƒ¨åˆ†ï¼Œå› æ­¤å¹¶ä¸æ¨èåœ¨ä½ çš„ä¸šåŠ¡ä»£ç ä¸­ç›´æ¥ä½¿ç”¨ `__proto__` è¿™ä¸ªå˜é‡ã€‚

![JavaScript Prototypal Inheritance](https://user-images.githubusercontent.com/11895199/47256895-7a423e00-d4b9-11e8-93a7-076259912244.png)

ä»ä¸Šå›¾å¯ä»¥æ¸…æ¥šçœ‹åˆ°ï¼Œ`prototype` æ˜¯ç”¨æ¥å­˜å‚¨ç±»å‹å…¬å…±æ–¹æ³•çš„ä¸€ä¸ªå¯¹è±¡ï¼ˆæ­£å› æ­¤æ¯ä¸ªç±»å‹æœ‰å®ƒåŸºæœ¬çš„æ–¹æ³•ï¼‰ï¼Œè€Œ `__proto__` æ˜¯ç”¨æ¥å®ç°å‘ä¸ŠæŸ¥æ‰¾çš„ä¸€ä¸ªå¼•ç”¨ã€‚ä»»ä½•å¯¹è±¡éƒ½ä¼šæœ‰ `__proto__`ã€‚`Object.prototype` çš„ `__proto__` æ˜¯ nullï¼Œä¹Ÿå³æ˜¯åŸå‹é“¾çš„ç»ˆç‚¹ã€‚

## æ„é€ å‡½æ•°åˆæ˜¯ä¸ªå•¥ç©æ„å„¿ï¼Ÿ

å†åŠ å…¥ constructor è¿™ä¸ªä¸œè¥¿ï¼Œå®ƒä¸ `prototype`ã€`__proto__` æ˜¯ä»€ä¹ˆå…³ç³»ï¼Ÿè¿™ä¸ªåœ°æ–¹ï¼Œè¯´å¤æ‚å°±å¾ˆå¤æ‚äº†ï¼Œè®©æˆ‘ä»¬å°½é‡æŠŠå®ƒè¯´ç®€å•ä¸€äº›ã€‚å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦æŸ¥é˜…ä¸€ä¸‹[è¯­è¨€è§„èŒƒ][ecmascript 2015(es6) specification]ï¼Œçœ‹ä¸€äº›åŸºæœ¬çš„å®šä¹‰ï¼š

* [å¯¹è±¡][specification: object]ï¼š[å¯¹è±¡æ˜¯ä¸€ç»„é›†åˆï¼Œå…¶ä¸­å¯åŒ…å«é›¶ä¸ªæˆ–å¤šä¸ªå±æ€§ã€‚å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªåŸå‹å¯¹è±¡ï¼ˆè¯‘è€…æ³¨ï¼šå³ [[Prototype]]/`__proto__`ï¼‰][specification: overview]
* å‡½æ•°ï¼š[æ˜¯å¯¹è±¡ç±»å‹çš„ä¸€å‘˜][specification: function]
* æ„é€ å‡½æ•°ï¼š[æ„é€ å‡½æ•°æ˜¯ä¸ªç”¨äºåˆ›å»ºå¯¹è±¡çš„**å‡½æ•°å¯¹è±¡**ã€‚æ¯ä¸ªæ„é€ å‡½æ•°éƒ½æœ‰ä¸€ä¸ª `prototype` å¯¹è±¡ï¼Œç”¨ä»¥å®ç°åŸå‹å¼ç»§æ‰¿ï¼Œä½œå±æ€§å…±äº«ç”¨][specification: constructor]

è¿™é‡Œè¯´æ˜äº†ä»€ä¹ˆå‘¢ï¼Ÿè¯´æ˜äº†æ„é€ å‡½æ•°æ˜¯å‡½æ•°ï¼Œå®ƒæ¯”æ™®é€šå‡½æ•°å¤šä¸€ä¸ª `prototype` å±æ€§ï¼›è€Œå‡½æ•°æ˜¯å¯¹è±¡ï¼Œå¯¹è±¡éƒ½æœ‰ä¸€ä¸ªåŸå‹å¯¹è±¡ `__proto__`ã€‚è¿™ä¸ªä¸œè¥¿æœ‰ä»€ä¹ˆä½œç”¨å‘¢ï¼Ÿ

ä¸ŠèŠ‚æˆ‘ä»¬æ·±æŒ–äº†ç”¨äºç»§æ‰¿çš„åŸå‹é“¾ï¼Œå®ƒé“¾æ¥çš„æ˜¯åŸå‹å¯¹è±¡ã€‚è€Œå¯¹è±¡æ˜¯é€šè¿‡æ„é€ å‡½æ•°ç”Ÿæˆçš„ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæ™®é€šå¯¹è±¡ã€åŸå‹å¯¹è±¡ã€å‡½æ•°å¯¹è±¡éƒ½å°†æœ‰å®ƒä»¬çš„æ„é€ å‡½æ•°ï¼Œè¿™å°†ä¸ºæˆ‘ä»¬å¼•å‡ºå¦ä¸€æ¡é“¾â€”â€”

![JavaScript Constructor Chain](https://user-images.githubusercontent.com/11895199/47259006-082c2200-d4d6-11e8-8abb-460b51719c50.png)

åœ¨ JavaScript ä¸­ï¼Œè°æ˜¯è°çš„æ„é€ å‡½æ•°ï¼Œæ˜¯é€šè¿‡ `constructor` æ¥æ ‡è¯†çš„ã€‚æ­£å¸¸æ¥è®²ï¼Œæ™®é€šå¯¹è±¡ï¼ˆå¦‚å›¾ä¸­çš„ `cat` å’Œ `{ name: 'Lin' }` å¯¹è±¡ï¼‰æ˜¯æ²¡æœ‰ `constructor` å±æ€§çš„ï¼Œå®ƒæ˜¯ä»åŸå‹ä¸Šç»§æ‰¿è€Œæ¥ï¼›è€Œå›¾ä¸­ç²‰çº¢è‰²çš„éƒ¨åˆ†å³æ˜¯å‡½æ•°å¯¹è±¡ï¼ˆå¦‚ `Cat` `Animal` `Object` ç­‰ï¼‰ï¼Œå®ƒä»¬çš„åŸå‹å¯¹è±¡æ˜¯ `Function.prototype`ï¼Œè¿™æ²¡æ¯›ç—…ã€‚å…³é”®æ˜¯ï¼Œå®ƒä»¬æ˜¯å‡½æ•°å¯¹è±¡ï¼Œå¯¹è±¡å°±æœ‰æ„é€ å‡½æ•°ï¼Œé‚£ä¹ˆå‡½æ•°çš„æ„é€ å‡½æ•°æ˜¯å•¥å‘¢ï¼Ÿæ˜¯ `Function`ã€‚é‚£ä¹ˆé—®é¢˜åˆæ¥äº†ï¼Œ`Function` ä¹Ÿæ˜¯å‡½æ•°ï¼Œå®ƒçš„æ„é€ å‡½æ•°æ˜¯è°å‘¢ï¼Ÿ**æ˜¯å®ƒè‡ªå·±**ï¼š`Function.constructor === Function`ã€‚ç”±æ­¤ï¼Œ`Function` å³æ˜¯æ„é€ å‡½æ•°é“¾çš„ç»ˆç»“ã€‚

ä¸Šé¢æˆ‘ä»¬æåˆ°ï¼Œ`constructor` ä¹Ÿå¯ä»¥ç”¨æ¥å®ç°åŸå‹é“¾çš„å‘ä¸ŠæŸ¥æ‰¾ï¼Œç„¶åå®ƒå´åˆ«æœ‰ä»–ç”¨ã€‚æœ‰ä¸ªå•¥ç”¨å‘¢ï¼Ÿä¸€èˆ¬è®¤ä¸ºï¼Œå®ƒæ˜¯ç”¨ä»¥æ”¯æ’‘ `instanceof` å…³é”®å­—å®ç°çš„æ•°æ®ç»“æ„ã€‚

## åŒé“¾åˆç’§ï¼šç»ˆæå…¨å›¾

å¥½äº†ï¼Œæ˜¯æ—¶å€™è¿›å…¥æœ€çƒ§è„‘çš„éƒ¨åˆ†äº†ã€‚å‰é¢æˆ‘ä»¬è®²äº†ä¸¤æ¡é“¾ï¼š

* åŸå‹é“¾ã€‚å®ƒç”¨æ¥å®ç°åŸå‹ç»§æ‰¿ï¼Œæœ€ä¸Šå±‚æ˜¯ `Object.prototype`ï¼Œç»ˆç»“äº `null`ï¼Œæ²¡æœ‰å¾ªç¯
* æ„é€ å‡½æ•°é“¾ã€‚å®ƒç”¨æ¥è¡¨æ˜æ„é€ å…³ç³»ï¼Œæœ€ä¸Šå±‚å¾ªç¯ç»ˆç»“äº `Function`

æŠŠè¿™ä¸¤æ¡é“¾ç»“åˆåˆ°ä¸€èµ·ï¼Œä½ å°±ä¼šçœ‹åˆ°~~ä¸€æ¡åŒèºæ—‹ DNA~~è¿™å‡ å¼ ä½ ç»å¸¸çœ‹åˆ°å´åˆçœ‹ä¸æ‡‚çš„å›¾ï¼š

[![constructor/prototype/proto](https://user-gold-cdn.xitu.io/2018/8/14/16537b65ee56f6f5?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)](https://juejin.im/post/5b729c24f265da280f3ad010)

[![constructor/prototype/proto](http://www.mollypages.org/tutorials/jsobj_full.jpg)](http://www.mollypages.org/tutorials/js.mp)

å›¾éƒ½æ˜¯å¼•ç”¨è‡ªå…¶å®ƒæ–‡ç« ï¼Œç‚¹å‡»å›¾ç‰‡å¯è·³è½¬åˆ°åŸæ–‡ã€‚å…¶ä¸­ï¼Œç¬¬ä¸€ç¯‡æ–‡ç«  [ä¸€å¼ å›¾ç†è§£ JS çš„åŸå‹][] æ˜¯æˆ‘è§è¿‡è§£æå¾—æœ€è¯¦ç»†çš„ï¼Œæœ¬æ–‡çš„å¾ˆå¤šçµæ„Ÿä¹Ÿæ¥è‡ªè¿™ç¯‡æ–‡ç« ã€‚

ç†è§£äº†ä¸Šé¢ä¸¤æ¡é“¾ä»¥åï¼Œè¿™ä¸¤ä¸ªå…¨å›¾å®é™…ä¸Šå°±ä¸éš¾ç†è§£äº†ã€‚åˆ†äº«ä¸€ä¸‹ï¼Œæ€ä¹ˆæ¥è¯»æ‡‚è¿™ä¸ªå›¾ï¼š

* é¦–å…ˆçœ‹æ„é€ å‡½æ•°é“¾ã€‚æ‰€æœ‰çš„æ™®é€šå¯¹è±¡ï¼Œ`constructor` éƒ½ä¼šæŒ‡å‘å®ƒä»¬çš„æ„é€ å‡½æ•°ï¼›è€Œæ„é€ å‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡ï¼Œå®ƒä»¬æœ€ç»ˆä¼šä¸€çº§ä¸€çº§ä¸Šæº¯åˆ° `Function` è¿™ä¸ªæ„é€ å‡½æ•°ã€‚`Function` çš„æ„é€ å‡½æ•°æ˜¯å®ƒè‡ªå·±ï¼Œä¹Ÿå³æ­¤é“¾çš„ç»ˆç»“ï¼›
* `Function` çš„ `prototype` æ˜¯ `Function.prototype`ï¼Œå®ƒæ˜¯ä¸ªæ™®é€šçš„åŸå‹å¯¹è±¡ï¼›
* å…¶æ¬¡çœ‹åŸå‹é“¾ã€‚æ‰€æœ‰çš„æ™®é€šå¯¹è±¡ï¼Œ`__proto__` éƒ½ä¼šæŒ‡å‘å…¶æ„é€ å‡½æ•°çš„åŸå‹å¯¹è±¡ `[Class].prototype`ï¼›è€Œæ‰€æœ‰åŸå‹å¯¹è±¡ï¼ŒåŒ…æ‹¬æ„é€ å‡½æ•°é“¾çš„ç»ˆç‚¹ `Function.prototype`ï¼Œéƒ½ä¼šæœ€ç»ˆä¸Šæº¯åˆ° `Object.prototype`ï¼Œç»ˆç»“äº nullã€‚

ä¹Ÿå³æ˜¯è¯´ï¼Œæ„é€ å‡½æ•°é“¾çš„ç»ˆç‚¹ `Function`ï¼Œå…¶åŸå‹åˆèå…¥åˆ°äº†åŸå‹é“¾ä¸­ï¼š`Function.prototype -> Object.prototype -> null`ï¼Œæœ€ç»ˆæŠµè¾¾åŸå‹é“¾çš„ç»ˆç‚¹ `null`ã€‚è‡³æ­¤è¿™ä¸¤æ¡å¥‘åˆåˆ°äº†ä¸€èµ·ã€‚

æ€»ç»“ä¸‹æ¥ï¼Œå¯ä»¥æ¦‚æ‹¬æˆè¿™å‡ å¥è¯ï¼š

* JS ä¸–ç•Œçš„å˜é‡é™¤äº†æ™®é€šç±»å‹å¤–éƒ½æ˜¯å¯¹è±¡ï¼ŒåŒ…æ‹¬å‡½æ•°ä¹Ÿæ˜¯å¯¹è±¡
* æ‰€æœ‰å¯¹è±¡éƒ½å¿…é¡»ç”±å‡½æ•°ç”Ÿæˆï¼ŒåŒ…æ‹¬æ™®é€šå¯¹è±¡ã€åŸå‹å¯¹è±¡åŠå‡½æ•°å¯¹è±¡
* æ‰€æœ‰å‡½æ•°æœ€ç»ˆéƒ½ç”Ÿæˆè‡ª `Function`ï¼ŒåŒ…æ‹¬ `Function` è‡ªå·±
* æ‰€æœ‰å¯¹è±¡æœ€ç»ˆéƒ½ç»§æ‰¿è‡ª `Object.prototype`ï¼ŒåŒ…æ‹¬ `Function.prototype`ï¼Œç»ˆæ­¢äº `null`

è¿™é‡Œè¿˜æœ‰æœ€åä¸€ä¸ªæ‰€è°“ã€Œé¸¡ç”Ÿè›‹è¿˜æ˜¯è›‹ç”ŸğŸ”ã€çš„é—®é¢˜ï¼šæ˜¯å…ˆæœ‰ `Object.prorotype`ï¼Œè¿˜æ˜¯å…ˆæœ‰ `Function`ï¼Ÿå¦‚æœå…ˆæœ‰å‰è€…ï¼Œé‚£ä¹ˆæ­¤æ—¶ `Function` è¿˜ä¸åœ¨ï¼Œè¿™ä¸ªå¯¹è±¡åˆæ˜¯ç”±è°åˆ›å»ºå‘¢ï¼Ÿå¦‚æœå…ˆæœ‰åè€…ï¼Œé‚£ä¹ˆ `Function` ä¹Ÿæ˜¯ä¸ªå¯¹è±¡ï¼Œå®ƒçš„åŸå‹ `Function.prototype.__proto__` ä»å“ªå»ç»§æ‰¿å‘¢ï¼Ÿè¿™ä¸ªé—®é¢˜ï¼Œçœ‹ä¼¼æ— è§£ã€‚ä½†ä» [è¿™ç¯‡æ–‡ç« ï¼šä»__proto__å’Œprototypeæ¥æ·±å…¥ç†è§£JSå¯¹è±¡å’ŒåŸå‹é“¾][ä»__proto__å’Œ prototype æ¥æ·±å…¥ç†è§£ JS å¯¹è±¡å’ŒåŸå‹é“¾] ä¸­ï¼Œæˆ‘ä»¬å‘ç°äº†ä¸€ä¸ªåˆç†çš„è§£é‡Šï¼Œé‚£å°±æ˜¯ï¼š

> `Object.prototype` æ˜¯ä¸ªç¥ä¹‹å¯¹è±¡ã€‚å®ƒä¸ç”± `Function` è¿™ä¸ªå‡½æ•°æ„é€ äº§ç”Ÿã€‚

è¯æ®å¦‚ä¸‹ï¼š

```javascript
Object.prototype instanceof Object                // false
Object.prototype instanceof Function              // false
Object.prototype.__proto__ === Function.prototype // false
```

JS å¯¹è±¡ä¸–ç•Œçš„æ„é€ æ¬¡åºåº”è¯¥æ˜¯ï¼š`Object.prototype` -> `Function.prototype` -> `Function` -> `Object` -> ...

## æ€»ç»“

è®²åˆ°è¿™é‡Œï¼Œæˆ‘æƒ³å…³äº JavaScript ç»§æ‰¿ä¸­çš„ä¸€äº›åŸºæœ¬é—®é¢˜å¯ä»¥è§£é‡Šæ¸…æ¥šäº†ï¼š

> JavaScript ç»§æ‰¿æ˜¯ç±»ç»§æ‰¿è¿˜æ˜¯åŸå‹ç»§æ‰¿ï¼Ÿä¸æ˜¯ä½¿ç”¨äº† new å…³é”®å­—ä¹ˆï¼Œåº”è¯¥è·Ÿç±»æœ‰å…³ç³»å§ï¼Ÿ

æ˜¯å®Œå…¨çš„åŸå‹ç»§æ‰¿ã€‚å°½ç®¡ç”¨äº† `new` å…³é”®å­—ï¼Œä½†å…¶å®åªæ˜¯ä¸ªè¯­æ³•ç³–ï¼Œè·Ÿç±»æ²¡æœ‰å…³ç³»ã€‚JavaScript æ²¡æœ‰ç±»ã€‚å®ƒä¸ç±»ç»§æ‰¿å®Œå…¨ä¸åŒï¼Œåªæ˜¯é•¿å¾—åƒã€‚å¥½æ¯”é›·é”‹å’Œé›·å³°å¡”çš„å…³ç³»ã€‚

> `prototype` æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Ÿç”¨æ¥å¹²å•¥ï¼Ÿ

`prototype` æ˜¯ä¸ªå¯¹è±¡ï¼Œåªæœ‰å‡½æ•°ä¸Šæœ‰ã€‚å®ƒæ˜¯ç”¨æ¥å­˜å‚¨å¯¹è±¡çš„å±æ€§ï¼ˆæ•°æ®å’Œæ–¹æ³•ï¼‰çš„åœ°æ–¹ï¼Œæ˜¯å®ç° JavaScript åŸå‹ç»§æ‰¿çš„åŸºç¡€ã€‚

> `__proto__` æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Ÿç”¨æ¥å¹²å•¥ï¼Ÿ

`__proto__` æ˜¯ä¸ªæŒ‡å‘ `prototype` çš„å¼•ç”¨ã€‚ç”¨ä»¥è¾…åŠ©åŸå‹ç»§æ‰¿ä¸­å‘ä¸ŠæŸ¥æ‰¾çš„å®ç°ã€‚è™½ç„¶å®ƒå¾—åˆ°äº†æ‰€æœ‰æµè§ˆå™¨çš„æ”¯æŒï¼Œä½†å¹¶ä¸æ˜¯è§„èŒƒæ‰€æ¨èçš„åšæ³•ã€‚ä¸¥è°¨åœ°è¯´ï¼Œå®ƒæ˜¯ä¸€ä¸ªæŒ‡å‘ `[[Prototype]]` çš„å¼•ç”¨ã€‚

> `constructor` æ˜¯ä»€ä¹ˆä¸œè¥¿ï¼Ÿç”¨æ¥å¹²å•¥ï¼Ÿ

æ˜¯å¯¹è±¡ä¸Šä¸€ä¸ªæŒ‡å‘æ„é€ å‡½æ•°çš„å¼•ç”¨ã€‚ç”¨æ¥è¾…åŠ© `instanceof` ç­‰å…³é”®å­—çš„å®ç°ã€‚

> ğŸ”ç”Ÿè›‹è¿˜æ˜¯è›‹ç”ŸğŸ”ï¼Ÿ

ç¥ç”Ÿé¸¡ï¼Œé¸¡ç”Ÿè›‹ã€‚

## å‚è€ƒ

* [ä¸€å¼ å›¾ç†è§£ JS çš„åŸå‹](https://juejin.im/post/5b729c24f265da280f3ad010)
* [Prototypal Inheritance in JavaScript](http://crockford.com/javascript/prototypal.html)
* [How Prototypal Inheritance really works](http://blog.vjeux.com/2011/javascript/how-prototypal-inheritance-really-works.html)
* [ECMAScript 2015(ES6) Specification](https://www.ecma-international.org/ecma-262/6.0/)
* [ä»__proto__å’Œ prototype æ¥æ·±å…¥ç†è§£ JS å¯¹è±¡å’ŒåŸå‹é“¾](https://github.com/creeperyang/blog/issues/9)
* [JavaScript æ·±å…¥ä¹‹ç»§æ‰¿çš„å¤šç§æ–¹æ³•](https://github.com/mqyqingfeng/Blog/issues/16)
* [MDN: Inheritance in JavaScript][]
* [MDN: Inheritance and the prototype chain][]
* [MDN: Details of the object model][]
* [MDN: `__proto__`][]

[ä¸‹ä¸€ç¯‡æ–‡ç« ]: https://blog.linesh.tw/#/post/2018-10-21-deep-dive-into-babel-inheritance
[javascript è¯­è¨€ç²¾ç²¹]: https://book.douban.com/subject/3590768/
[mdn: inheritance in javascript]: https://developer.mozilla.org/en-US/docs/Learn/JavaScript/Objects/Inheritance
[mdn: inheritance and the prototype chain]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Inheritance_and_the_prototype_chain
[mdn: details of the object model]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Details_of_the_Object_Model
[mdn: `__proto__`]: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/proto
[specification: overview]: https://www.ecma-international.org/ecma-262/6.0/#sec-ecmascript-overview
[specification: object]: https://www.ecma-international.org/ecma-262/6.0/#sec-terms-and-definitions-object
[specification: function]: https://www.ecma-international.org/ecma-262/6.0/#sec-terms-and-definitions-function
[specification: constructor]: https://www.ecma-international.org/ecma-262/6.0/#sec-constructor
