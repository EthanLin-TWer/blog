---
title: ä¸€ç§æ›´åŠ æœ‰æ•ˆçš„Reactå•å…ƒæµ‹è¯•åŠæœ€ä½³å®è·µï¼ˆäºŒï¼‰
tags: react unit-test tdd rtl react-testing-library jest design-system
---

æœ‰æ•ˆçš„è‡ªåŠ¨åŒ–æµ‹è¯•æ˜¯ä»»ä½•ä¼ä¸šçº§é¡¹ç›®çš„å¿…é€‰é¡¹å’Œè´¨é‡æ ¹åŸºã€‚è€Œå®è·µå·²ç»è¯æ˜ï¼Œåœ¨å‰ç«¯ä»…åšç»„ä»¶å¼çš„å•å…ƒæµ‹è¯•ä¸å¤Ÿæœ‰æ•ˆã€‚æœ¬æ–‡å°†ä»‹ç»ä¸€ç§æ›´ä¸ºæœ‰æ•ˆçš„å•å…ƒæµ‹è¯•æ–¹å¼ï¼Œè®©æµ‹è¯•èƒ½å¤Ÿæ›´å¥½åœ°æ”¯æ’‘é‡æ„å’Œå¼€å‘ã€‚è¿™å¥—ç»éªŒæ›¾æ”¯æ’‘ç¬”è€…ç»å†çš„ä¸€ä¸ªå¹´åäº¿ç¾å…ƒçº§ã€å†æ—¶äº”å¹´+çš„äº¤æ˜“ç³»ç»Ÿçš„æˆåŠŸè¿è¥å’Œç»´æŠ¤æ¼”è¿›ã€‚

## å¤ªé•¿ä¸è¯»â€”â€”æœ¬æ–‡ä¸­å¿ƒè§‚ç‚¹

æ­£å¦‚æˆ‘åœ¨5å¹´å‰çš„[Reactå•å…ƒæµ‹è¯•ç­–ç•¥åŠè½åœ°][reactå•å…ƒæµ‹è¯•ç­–ç•¥]ä¸­æ‰€è¯´ï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œè€Œä¸”æ˜¯**æœ‰æ•ˆçš„è‡ªåŠ¨åŒ–æµ‹è¯•**ï¼Œ**å¯¹äºä»»ä½•ä¸€ä¸ªä¼ä¸šçº§é¡¹ç›®æ¥è¯´éƒ½æ˜¯å¿…é€‰é¡¹è€Œä¸æ˜¯å¯é€‰é¡¹**ã€‚è¿™æ˜¯ç”±ä¼ä¸šé¡¹ç›®çš„ä¸¤ä¸ªç‰¹ç‚¹å†³å®šçš„ï¼š**äººå‘˜æµåŠ¨ä¸å¯é¿å…**ã€**åº”ç”¨æ¼”è¿›ä¸å¯é¿å…**ã€‚è¿™ä¸¤ç‚¹ä¸å› äººçš„ä¸»è§‚æ„å¿—ä¸ºè½¬ç§»ã€‚åº”ç”¨æ¼”è¿›ï¼Œæ„å‘³ç€æ–°çš„ã€é—ç•™çš„ä¸šåŠ¡å’Œä»£ç ä¼šè¶Šæ¥è¶Šå¤šï¼›äººå‘˜æµåŠ¨ï¼Œæ„å‘³ç€ç‰©ç†ä¸Šä¸å¯èƒ½ä¼šæœ‰ä¸€ä¸ªäººèƒ½é•¿æœŸã€å®Œå…¨åœ°æŒæ¡å•ä¸ªåº”ç”¨çš„æ‰€æœ‰ä¸Šä¸‹æ–‡ã€‚å› æ­¤ï¼Œå¸Œæœ›é€šè¿‡æ‰‹å·¥æµ‹è¯•ï¼ˆå¼€å‘è€…è‡ªæµ‹æˆ–è€…å•ç‹¬çš„QAå›¢é˜Ÿæ‰‹æµ‹ï¼‰çš„æ–¹å¼æ¥ä¿éšœè´¨é‡ï¼Œé¦–å…ˆæ—¢æ˜¯ä½æ•ˆçš„ï¼Œé•¿æœŸæ¥çœ‹ä¹Ÿæ˜¯ä¸å¯èƒ½çš„ã€‚

é‚£ä¹ˆï¼Œæœ‰äº†è‡ªåŠ¨åŒ–æµ‹è¯•å°±å¯ä»¥äº†å—ï¼Ÿç­”æ¡ˆä¹Ÿä¸æ˜¯ã€‚æˆ‘è§è¿‡è®¸å¤šæ— æ•ˆçš„è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œæœ€ç—›çš„è«è¿‡äºèŠ±è´¹è®¸å¤šç²¾åŠ›å†™äº†æµ‹è¯•ï¼Œå´å‘ç°æµ‹è¯•æ— æ³•æ”¯æ’‘é‡æ„ï¼Œè®¸å¤šç®€å•çš„é‡æ„æ¯”å¦‚Reactç»„ä»¶é‡å‘½åã€æ¬ç§»æ•°æ®åˆ°Contextéƒ½ä¼šæŒ‚è®¸å¤šæµ‹è¯•ï¼Œç›´æ¥å¯¹å¼€å‘æ•ˆèƒ½èµ·è´Ÿä½œç”¨ã€‚å…¶æ¬¡ï¼Œæµ‹è¯•ç¼ºä¹æœ‰è¡¨è¾¾åŠ›ã€æœ‰æ„ä¹‰çš„æ–­è¨€ï¼Œæˆ–è€…æµ‹è¯•çš„æè¿°ä¸æ–­è¨€ä¸çœŸå®ä¸šåŠ¡åœºæ™¯è„±èŠ‚ï¼ˆæµ‹è¯•æ–­è¨€çš„æ˜¯é¡µé¢ä¸Šæœ‰æ²¡æœ‰â€œï¿¥400â€ï¼Œå…³è”çš„ä¸šåŠ¡åœºæ™¯å´æ˜¯æŠ¥ä»·èƒ½å¦æˆåŠŸï¼‰ç­‰ç­‰ï¼Œä¹Ÿéƒ½æ˜¯å¸¸è§çš„æ— æ•ˆæµ‹è¯•æ¨¡å¼ã€‚è¿™æ ·çš„æ— æ•ˆæµ‹è¯•ï¼Œéƒ½ä¸èƒ½å¸®åŠ©ä½ ç•™å­˜ä¸šåŠ¡çŸ¥è¯†ã€æ”¯æ’‘éšæ—¶éšåœ°è¿›è¡Œçš„æŠ€æœ¯é‡æ„ï¼Œä¹Ÿæ— æ³•çœŸæ­£åŠ©åŠ›è½¯ä»¶è´¨é‡å’Œç ”å‘æ•ˆèƒ½çš„æå‡ï¼Œä¹…è€Œä¹…ä¹‹åªä¼šè®©æµ‹è¯•å˜æˆä¸€åœºè¡¨æ¼”ï¼Œå˜æˆä¸å¾—ä¸åº”ä»˜è€Œåˆå¼ƒä¹‹å¯æƒœçš„é¸¡è‚‹ã€‚

ä½ éœ€è¦çš„æ˜¯çœŸæ­£**æœ‰æ•ˆçš„è‡ªåŠ¨åŒ–æµ‹è¯•**ã€‚

å¦‚æœä½ æ˜¯ä¼ä¸šçš„ä¸­å±‚æŠ€æœ¯ç®¡ç†è€…ï¼ˆTech Leadæˆ–è€…Technical Principleç­‰ï¼‰ï¼Œé‚£ä¹ˆè¿™æ˜¯ä½ åº”è¯¥å…³æ³¨çš„é—®é¢˜ï¼›å¦‚æœä½ æ˜¯æ­£åœ¨åŠªåŠ›æˆä¸ºæŠ€æœ¯éª¨å¹²çš„å¼€å‘è€…ï¼Œè¿™ç¯‡æ–‡ç« ä¹Ÿæ­£æ˜¯ä¸ºä½ å‡†å¤‡çš„ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä¼šä»‹ç»ä»€ä¹ˆæ˜¯æœ‰æ•ˆçš„è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Œç„¶åä»¥ä¸€ä¸ªReactåº”ç”¨ä¸ºèƒŒæ™¯ï¼Œä»‹ç»ä¸€ä¸ªå¸¸è§ä¸”æœ‰æ•ˆçš„æµ‹è¯•ç­–ç•¥æ˜¯ä»€ä¹ˆã€ä½œä¸ºå…³é”®éƒ¨åˆ†çš„å•å…ƒæµ‹è¯•åº”è¯¥æ€ä¹ˆæ¶æ„ã€æ€ä¹ˆç¼–å†™ï¼Œæˆ‘ä¼šç»™å‡ºååˆ†å……è¶³çš„ä»£ç æ ·ä¾‹å¸®åŠ©ä½ å’Œä½ çš„å›¢é˜Ÿå»è½åœ°ã€‚æœ€åï¼Œæˆ‘è¿˜ä¼šä»‹ç»è¿™éƒ¨åˆ†å…³é”®çš„å•å…ƒæµ‹è¯•æ–¹å¼æœ‰ä»€ä¹ˆæŒ‘æˆ˜ï¼Œå¸®åŠ©ä½ å¯¹è¿™é¡¹æŠ€æœ¯çŸ¥å·±çŸ¥å½¼ã€‚

è¿™å¥—ç»éªŒæ˜¯æˆ‘åœ¨è¿‡å»ä¸‰å¹´ã€ä¸¤ä¸ªé¡¹ç›®ä¸Šçš„å®è·µå’Œæ€»ç»“ã€‚å®ƒæˆåŠŸåœ°å¸®åŠ©æˆ‘ä»¬èƒ½å¤Ÿåœ¨ä¸€ä¸ªæ”¯æ’‘è¡Œå†…å¹´åäº¿ç¾å…ƒçº§äº¤æ˜“æ•°é¢çš„åº”ç”¨ä¸Šï¼Œå†æ—¶5å¹´+ã€è¿˜æ²¡ä¸ŠTSçš„æƒ…å†µä¸‹ä»èƒ½è‡ªä¿¡åœ°ä¿®æ”¹å’Œé‡æ„ä»£ç ï¼›å®ƒä¹ŸæˆåŠŸåœ°å¸®åŠ©äº†æˆ‘ä»¬å½“å‰çš„é¡¹ç›®ä»0åˆ°1æ­å»ºèµ·æœ‰æ•ˆçš„æµ‹è¯•ç­–ç•¥ï¼Œå¦‚ä»Šä¸€ä¸ªå…·æœ‰å¤æ‚é€»è¾‘çš„é¡µé¢å·²ç»æœ‰4000è¡Œæµ‹è¯•ä»£ç çš„æœ‰æ•ˆè¦†ç›–ã€‚è¿™ç¯‡æ–‡ç« æ˜¯å®è·µä¸­è¯ç”Ÿçš„ç»éªŒå’Œæ€»ç»“ã€‚

èˆå°å·²ç»æ­å¥½ï¼Œä¸‹é¢è®©æˆ‘ä»¬ç›´å¥”ä¸»é¢˜~~ç›´æ¥å¼€æ¼”~~ã€‚

ğŸš§æ­£æ–‡å†…å®¹æ­£åœ¨æ–½å·¥ä¸­ã€‚

## å¤§çº² / ç›®å½•

* ä¸ºä»€ä¹ˆâ€¦â€¦
  * ~~è¦åšæµ‹è¯•ï¼Ÿå› ä¸ºé¡¹ç›®ä¸€å®šä¼šå˜å¤§å¯¼è‡´ä¾æ®ä¸ªäººç»éªŒçš„æ‰‹åŠ¨æµ‹è¯•åœ¨äººåŠ›ä¸Šä¸å¯è¡Œã€äººå‘˜ä¸€å®šä¼šæµåŠ¨è€Œå¯¼è‡´ä¸Šä¸‹æ–‡ä¸¢å¤±ã€‚ä»»ä½•é¡¹ç›®éƒ½è¿™æ ·~~
  * æ˜¯è¿™ä¸ªç­–ç•¥ï¼ŸMVVMåˆ†ç¦»ä¸ºä»€ä¹ˆä¸è¡Œï¼Ÿä¸å®é™…ã€‚æœ‰äº†Hooksä»¥åï¼Œç°ä»£Reactç»„ä»¶å…¶å®å°±æ˜¯ä¸ªç»„åˆæ‰€æœ‰é€»è¾‘çš„åœ°æ–¹ï¼Œæ‰€æœ‰åè°ƒéƒ½åœ¨è¿™é‡Œ
  * æœ‰ä»€ä¹ˆå¥½å¤„ï¼Ÿæ”¯æŒé‡æ„ï¼šæ”¹åŠŸèƒ½æ—¶æµ‹è¯•èƒ½æœ‰æ•ˆä¿éšœè¡Œä¸ºã€ä¸éœ€è¦æ”¹åŠ¨ç›¸åº”çš„æµ‹è¯•ï¼›è¶Šå†™è¶Šé¡ºæ‰‹ï¼Œç»„åˆå¼ï¼Œå†™æ–°æµ‹è¯•ç›¸å½“å®¹æ˜“ï¼›æµ‹è¯•æ–­è¨€å£°æ˜å¼ã€‚
* ä»€ä¹ˆæ˜¯æ— æ•ˆçš„è‡ªåŠ¨åŒ–æµ‹è¯•ï¼Ÿ
* æ¶æ„ï¼ˆé»‘é©¬ç®€ä»‹ï¼‰
  * hookï¼šhookçš„å•å…ƒæµ‹è¯•
  * å…¶ä»–å±‚çš„æµ‹è¯•ï¼šå¥‘çº¦æµ‹è¯•
  * ä½¿ç”¨React Queryç­‰global statement managementçš„åº“
  * å…¶ä»–hookçš„æµ‹è¯•ï¼šå‰¯ä½œç”¨ï¼Œå¦‚windowsã€analyticsç­‰ã€‚
* æµ‹è¯•æ¶æ„&ä¾‹å­
  * API mock
  * ç»„ä»¶å±‚
* æ–°çš„è¡ç”Ÿé—®é¢˜
  * ä»¥ä»€ä¹ˆä¸ºâ€œé¡µé¢â€å•ä½ï¼Ÿè·¯ç”±æˆ–é¡µé¢ç»„ä»¶ï¼ˆPage componentï¼‰
  * æµ‹è¯•æ–‡ä»¶è¿‡é•¿ï¼šæŠ½å‡½æ•°ã€æ”¾å¼ƒä¸å¿…è¦çš„æ–­è¨€
  * æµ‹è¯•æ–‡ä»¶å¦‚ä½•ç»„ç»‡ï¼šä»¥åŠŸèƒ½ç»„ç»‡ï¼Œå†™çš„æ—¶å€™å¯èƒ½è·¨å¥½å‡ ä¸ª`describe`/æ–‡ä»¶ï¼Œéš¾ä»¥å‘ç°ã€éš¾ä»¥ç»´æŠ¤ï¼›ä»¥é¡µé¢ç»„ç»‡ï¼Œå®¹æ˜“å¾ˆåˆ†æ•£ï¼Œçœ‹ä¸å‡ºä¸šåŠ¡é€»è¾‘ã€‚
* æœ‰ä»€ä¹ˆæŒ‘æˆ˜ï¼Ÿ

é‚£ä¹ˆï¼Œä»€ä¹ˆæ˜¯æœ‰æ•ˆçš„è‡ªåŠ¨åŒ–æµ‹è¯•å‘¢ï¼Ÿ

åœ¨Reactå’Œå‰ç«¯è¿™ä¸ªä¸Šä¸‹æ–‡ä¸­ï¼Œå•å…ƒæµ‹è¯•ä¸æ˜¯æœ€ä¼˜è§£â€”â€”é›†æˆå¼çš„å•å…ƒæµ‹è¯•æ‰æ˜¯ã€‚ä½†æˆ‘æ— æ„å‘æ˜æ–°çš„åè¯ï¼Œå› æ­¤ï¼Œæœ¬æ–‡æ‰€éœ€çš„åªæ˜¯ä¸€ä¸ªç”¨æ¥æŒ‡ä»£æœ¬æ–‡è¿™æ ·ä¸€ç§æµ‹è¯•æ–¹å¼çš„ã€‚

æŒ‘æˆ˜æ˜¯ä»€ä¹ˆï¼šä¸€ä¸ªæœ‰æ•ˆçš„æµ‹è¯•ç­–ç•¥ï¼Œä»¥åŠç¼–å†™æµ‹è¯•çš„èƒ½åŠ›ã€‚
ä»€ä¹ˆæ˜¯æµ‹è¯•ç­–ç•¥ï¼š

## ä¸ä¸Šä¸€ç‰ˆçš„å˜åŒ–

å¦‚æœä½ æ˜¯ä¸Šä¸€ç‰ˆ[Reactå•å…ƒæµ‹è¯•ç­–ç•¥åŠè½åœ°][reactå•å…ƒæµ‹è¯•ç­–ç•¥]çš„è¯»è€…â€”â€”

* å¯ä»¥åè¡¥æµ‹è¯•â€”â€”é€‚ç”¨äºé—ç•™ä»£ç ã€ä¸­é€”å­¦ä¹ TDD/æµ‹è¯•çš„å›¢é˜Ÿã€‚
* æ”¯æŒé‡æ„ï¼Œæ”¹åŠ¨åŠŸèƒ½çš„æ—¶å€™æµ‹è¯•ä¸ä¼šå¤§èŒƒå›´æŒ‚ã€‚
* reducer/selectorç”±äº`useMemo`çš„å­˜åœ¨æŒªåˆ°ç»„ä»¶å†…éƒ¨äº†ï¼Œå¯ä»¥è½¬è€Œå˜ä¸ºhooks/utilsçš„å•å…ƒæµ‹è¯•ï¼›
* sagaå»ºè®®æŒªåˆ°React Queryäº†ï¼Œä¹‹å‰çš„saga/ç¼–æ’å±‚ä¸æ¨èè¿›è¡Œæµ‹è¯•äº†ï¼Œå»ºè®®é‡‡ç”¨æœ€æ–°çš„æµ‹è¯•ç­–ç•¥è¦†ç›–ï¼›

## ä»€ä¹ˆæ˜¯æœ‰æ•ˆçš„è‡ªåŠ¨åŒ–æµ‹è¯•

## Reactåº”ç”¨çš„å¸¸è§æ¶æ„

## æµ‹è¯•ç­–ç•¥

## å…·ä½“ä»£ç è½åœ°

* æµ‹è¯•ä»£ç æ¶æ„ï¼šAPI DSLï¼ˆæ–¹ä¾¿çš„API mockè¯­æ³•ï¼‰+Fixtureï¼ˆmockæ•°æ®ï¼‰+testerï¼ˆé€‰æ‹©å™¨ï¼‰+expectationsï¼ˆæµ‹è¯•æ–­è¨€ï¼‰
* API mock & DSL
* ç»„ä»¶å±‚testeræ²‰æ·€å’ŒAPIè®¾è®¡
* æµ‹è¯•ä¸»ä½“
  * UIå†…å®¹æ–­è¨€
  * ç”¨æˆ·è¡Œä¸ºäº¤äº’
  * API Mock

```typescript
interface DropdownTester {
  getLabel(): string;
  getValue(): string;
  getDisplayText(): string;
}

export const findDropdown = (testId: string): DropdownTester => {
  const getElement = () => screen.getByTestId(testId)
  const getLabel = () => screen.getByTestId(`${testId}-dropdown-label`).textContent 
  const getValue = () => screen.getByTestId(`${testId}-dropdown-input`).getAttribute('value') 
  const getDisplayText = () => { return /* ... */ }

  return { getLabel, getValue, getDisplayText }
}
```

## æŒ‘æˆ˜

* æœ‰ä¸€å®šçš„å¼€å‘æˆæœ¬â€”â€”ç›¸æ¯”çº¯å‡½æ•°è€Œè¨€ã€‚
* æœ‰ä¸€å®šçš„ç»´æŠ¤æˆæœ¬â€”â€”éœ€è¦ä¿è¯æµ‹è¯•é—´ç‹¬ç«‹æ€§ï¼ˆå› ä¸ºå¼•å…¥äº†API mockè€Œä¸æ˜¯ç»„ä»¶çº§åˆ«çš„mockï¼‰ã€ç­‰
* å®šä½é—®é¢˜çš„èƒ½åŠ›ç›¸å¯¹â€œç»å¯¹çš„å•å…ƒæµ‹è¯•â€æœ‰æ‰€é™ä½ã€‚

## References 

* testing pyramid 
* series from Jimmy

[^automated-tests-for-enterprise-only]: å¯¹äºä¸ªäººé¡¹ç›®ï¼Œè‡ªåŠ¨åŒ–æµ‹è¯•ä¹ƒè‡³TDDå®è·µæ˜¯å¦å¿…é¡»åªè·Ÿç»´æŠ¤æœ‰å…³ï¼Œä½ è‡ªå·±å¼€å¿ƒå°±è¡Œã€‚

[reactå•å…ƒæµ‹è¯•ç­–ç•¥]: https://blog.linesh.tw/#/post/2018-07-13-react-unit-testing-strategy
