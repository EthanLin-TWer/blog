{"id":"2016-09-17-junit5-basics","title":"ã€Œè¯‘ã€JUnit 5 ç³»åˆ—ï¼šåŸºç¡€å…¥é—¨","contents":"\n\n> åŸæ–‡åœ°å€ï¼š[http://blog.codefx.org/libraries/junit-5-basics/](http://blog.codefx.org/libraries/junit-5-basics/)  \n> åŸæ–‡æ—¥æœŸï¼š25, Feb, 2016  \n> è¯‘æ–‡é¦–å‘ï¼š[ Linesh çš„åšå®¢ï¼šã€Œè¯‘ã€JUnit 5 ç³»åˆ—ï¼šåŸºç¡€å…¥é—¨](http://blog.linesh.tw/#/posts/2016-09-17-junit5-basics)  \n> æˆ‘çš„ Githubï¼š[http://github.com/linesh-simplicity](http://github.com/linesh-simplicity)\n\nä¸Šå‘¨æˆ‘ä»¬åˆšåˆš[æ­å»ºå¥½äº† JUnit 5 çš„ç¯å¢ƒ][JUnit 5: Setup]ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥å†™æµ‹è¯•äº†ã€‚è¿™èŠ‚å°±è®©æˆ‘ä»¬æ¥å†™å®ƒå‡ ä¸ªå§ï¼\n\n## æ¦‚è¿°\n\næœ¬æ–‡ç« æ˜¯è¿™ä¸ª JUnit 5 ç³»åˆ—çš„ä¸€éƒ¨åˆ†ï¼š\n\n* [ç¯å¢ƒæ­å»º][JUnit 5: Setup]\n* [åŸºç¡€å…¥é—¨][JUnit 5: Basics]\n* [æ¶æ„ä½“ç³»][JUnit 5: Architecture]\n* [æ‰©å±•æ¨¡å‹ï¼ˆExtension Model)][JUnit 5: Extension Model]\n* [æ¡ä»¶æ–­è¨€][JUnit 5: Conditions]\n* æ³¨å…¥\n* [åŠ¨æ€æµ‹è¯•][JUnit 5: Dynamic Tests]\n* ...\n\nï¼ˆå¦‚æœä¸å–œæ¬¢çœ‹æ–‡ç« ï¼Œä½ å¯ä»¥[æˆ³è¿™é‡Œçœ‹æˆ‘çš„æ¼”è®²](http://blog.codefx.org/past-talks/)ï¼Œæˆ–è€…[çœ‹ä¸€ä¸‹æœ€è¿‘çš„ vJUG è®²åº§](https://www.youtube.com/watch?v=ct9sIsrnE9Y)ï¼Œæˆ–è€…[æˆ‘åœ¨ DevoxxPL ä¸Šçš„ PPT](https://www.youtube.com/watch?v=oG80XZUN1lQ)ã€‚\n\næœ¬ç³»åˆ—æ–‡ç« éƒ½åŸºäº Junit 5å‘å¸ƒçš„å…ˆè¡Œç‰ˆ [Milestone 2][User guide: M2]ã€‚å®ƒå¯èƒ½ä¼šæœ‰å˜åŒ–ã€‚å¦‚æœæœ‰æ–°çš„é‡Œç¨‹ç¢‘ï¼ˆmilestoneï¼‰ç‰ˆæœ¬å‘å¸ƒï¼Œæˆ–è€…è¯•ç”¨ç‰ˆæ­£å¼å‘è¡Œæ—¶ï¼Œæˆ‘ä¼šå†æ¥æ›´æ–°è¿™ç¯‡æ–‡ç« ã€‚\n\nè¿™é‡Œè¦ä»‹ç»çš„å¤šæ•°çŸ¥è¯†ä½ éƒ½å¯ä»¥åœ¨ [JUnit 5 ç”¨æˆ·æŒ‡å—][User guide: M2] ä¸­æ‰¾åˆ°ï¼ˆè¿™ä¸ªé“¾æ¥æŒ‡å‘çš„æ˜¯å…ˆè¡Œç‰ˆ Milestone 2ï¼Œæƒ³çœ‹çš„æœ€æ–°ç‰ˆæœ¬æ–‡æ¡£çš„è¯è¯·æˆ³[è¿™é‡Œ][User guide: Current]ï¼‰ï¼Œå¹¶ä¸”æŒ‡å—è¿˜æœ‰æ›´å¤šçš„å†…å®¹ç­‰å¾…ä½ å‘æ˜ã€‚ä¸‹é¢çš„æ‰€æœ‰ä»£ç éƒ½å¯ä»¥åœ¨ [æˆ‘çš„ Github](https://github.com/CodeFX-org/demo-junit-5) ä¸Šæ‰¾åˆ°ã€‚\n\n## ç›®å½•\n\n* è®¾è®¡å“²å­¦\n* JUnit 5é¢„å¤‡ï¼š\n    * åŒ…å¯è§æ€§\n    * æµ‹è¯•çš„ç”Ÿå‘½å‘¨æœŸ\n        * @Test\n        * Before å’Œ After\n        * ç¦ç”¨æµ‹è¯•\n        * æµ‹è¯•ç±»çš„ç”Ÿå‘½å‘¨æœŸ\n    * æ–­è¨€\n        * å¸¸è§„æ–­è¨€\n        * æ‰©å±•æ–­è¨€\n    * å‡è¨€/åˆ¤å®šï¼ˆAssumptionsï¼‰\n    * æµ‹è¯•åµŒå¥—\n    * æµ‹è¯•å‘½å\n* å›é¡¾\n* åˆ†äº«&å…³æ³¨\n\n## è®¾è®¡å“²å­¦\n\næ–°çš„[æ¶æ„è®¾è®¡][JUnit 5: Architecture]ï¼ˆè¿™ä¸ªæˆ‘ä»¬æ—¥åèŠï¼‰ï¼Œå…¶å…³æ³¨ç‚¹åœ¨é«˜æ‰©å±•æ€§ã€‚å¦‚æœåé¢å‡ºç°äº†ä»€ä¹ˆç¥ä¹‹æµ‹è¯•æŠ€æœ¯ï¼ˆè‡³å°‘å¯¹æˆ‘ä»¬å¹¿å¤§ JavağŸ¶æ¥è¯´å¾ˆç¥çš„ï¼‰ï¼Œå®ƒä»¬ä¹Ÿå¯èƒ½åœ¨ JUnit 5 çš„æ¶æ„ä¸‹è¢«å®ç°ã€‚\n\nä¸è¿‡å½“å‰æ¥è¯´ï¼Œæ¶‰åŠçš„åŸºç¡€çŸ¥è¯†ä¸ JUnit 4 æ˜¯éå¸¸ç›¸ä¼¼çš„ã€‚JUnit 5 çš„æ”¹åŠ¨å¹¶ä¸æ¿€è¿›ï¼Œç›¸åå®ƒçš„ä¼˜åŒ–å†ç¨‹æ˜¯å°å¿ƒç¿¼ç¿¼ï¼Œå°æ­¥è¿­ä»£çš„ã€‚å› æ­¤ï¼Œå¼€å‘è€…åº”è¯¥ä¼šå¯¹æ–°çš„ API æ„Ÿåˆ°éå¸¸ç†Ÿæ‚‰ã€‚è‡³å°‘æˆ‘æ˜¯è¿™æ ·çš„ï¼Œæˆ‘ç›¸ä¿¡ä½ ä¹Ÿä¸ä¼šæ„Ÿè§‰é™Œç”Ÿï¼š\n\n```java\nclass Lifecycle {\n \n\t@BeforeAll\n\tstatic void initializeExternalResources() {\n\t\tSystem.out.println(\"Initializing external resources...\");\n\t}\n \n\t@BeforeEach\n\tvoid initializeMockObjects() {\n\t\tSystem.out.println(\"Initializing mock objects...\");\n\t}\n \n\t@Test\n\tvoid someTest() {\n\t\tSystem.out.println(\"Running some test...\");\n\t\tassertTrue(true);\n\t}\n \n\t@Test\n\tvoid otherTest() {\n\t\tassumeTrue(true);\n \n\t\tSystem.out.println(\"Running another test...\");\n\t\tassertNotEquals(1, 42, \"Why wouldn't these be the same?\");\n\t}\n \n\t@Test\n\t@Disabled\n\tvoid disabledTest() {\n\t\tSystem.exit(1);\n\t}\n \n\t@AfterEach\n\tvoid tearDown() {\n\t\tSystem.out.println(\"Tearing down...\");\n\t}\n \n\t@AfterAll\n\tstatic void freeExternalResources() {\n\t\tSystem.out.println(\"Freeing external resources...\");\n\t}\n \n}\n```\n\næ˜¯å§ï¼Ÿè¿™é‡Œå¹¶æ²¡æœ‰å¾ˆå¤§çš„æ”¹åŠ¨ã€‚\n\n## JUnit 5 é¢„å¤‡\n\n### åŒ…å¯è§æ€§\n\n JUnit 5 æœ€æ˜æ˜¾çš„å˜åŒ–åº”è¯¥æ˜¯ï¼Œä¸å†éœ€è¦æ‰‹åŠ¨å°†æµ‹è¯•ç±»ä¸æµ‹è¯•æ–¹æ³•ä¸º `public` äº†ã€‚åŒ…å¯è§çš„è®¿é—®çº§åˆ«å°±è¶³å¤Ÿäº†ã€‚å½“ç„¶ï¼Œç§æœ‰ï¼ˆprivateï¼‰è®¿é—®è¿˜æ˜¯ä¸è¡Œçš„ã€‚æˆ‘è®¤ä¸ºè¿™ä¸ªå˜åŒ–æ˜¯åˆç†çš„ï¼Œä¹Ÿç¬¦åˆæˆ‘ä»¬å¯¹å¯è§æ€§çš„ä¸€èˆ¬ç›´è§‰ã€‚\n\nè¿™å¾ˆå¥½ï¼è‡³å°‘å¯ä»¥å°‘æ‰“å‡ ä¸ªå­—æ¯äº†ã€‚ä¸è¿‡ï¼Œæˆ‘ç›¸ä¿¡ä½ ä¹Ÿä¸æ˜¯æ¯æ¬¡éƒ½æ‰‹æ‰“è¿™å‡ ä¸ªå­—æ¯çš„ï¼Œæ˜¯å§ï¼Ÿå°½ç®¡å¦‚æ­¤è¿˜æ˜¯å¾ˆå¥½ï¼Œå°‘ä¸€äº›å…³é”®å­—ï¼Œä½ åœ¨çœ‹æµ‹è¯•çš„æ—¶å€™ä¹Ÿå°‘äº›åˆ‡æ¢ã€‚\n\n### æµ‹è¯•çš„ç”Ÿå‘½å‘¨æœŸ\n\n#### @Test\n\nJUnit ä¸­æœ€åŸºæœ¬çš„æ³¨è§£é `@Test` è«å±äº†ã€‚å®ƒä¼šæ ‡è®°æ–¹æ³•ä¸ºæµ‹è¯•æ–¹æ³•ï¼Œä»¥ä¾¿æ„å»ºå·¥å…·å’Œ IDE èƒ½å¤Ÿè¯†åˆ«å¹¶æ‰§è¡Œå®ƒä»¬ã€‚\n\nå®ƒçš„ API å’Œä½œç”¨å¹¶æ²¡æœ‰å˜åŒ–ï¼Œä¸è¿‡å®ƒä¸å†æ¥å—ä»»ä½•å‚æ•°äº†ã€‚è‹¥è¦æµ‹è¯•æ˜¯å¦[æŠ›å‡ºå¼‚å¸¸](http://junit.org/junit4/javadoc/latest/org/junit/Test.html#expected%28%29)ï¼Œä½ å¯ä»¥é€šè¿‡æ–°çš„[æ–­è¨€ API ](http://blog.codefx.org/libraries/junit-5-basics/#assertions)æ¥åšåˆ°ï¼›ä¸è¿‡å°±æˆ‘æ‰€çŸ¥ï¼Œç›®å‰è¿˜æ²¡æœ‰[è¶…æ—¶é€‰é¡¹timeout](http://junit.org/junit4/javadoc/latest/org/junit/Test.html#timeout%28%29)çš„æ›¿ä»£å“ã€‚\n\nä¸ JUnit 4ä¸€æ ·ï¼ŒJUnit 5 ä¼šä¸ºæ¯ä¸ªæµ‹è¯•æ–¹æ³•åˆ›å»ºä¸€ä¸ªæ–°çš„å®ä¾‹ã€‚\n\n#### Before å’Œ After\n\nä½ å¯èƒ½éœ€è¦æ‰§è¡Œä¸€äº›ä»£ç æ¥åœ¨æµ‹è¯•æ‰§è¡Œå‰åå®Œæˆä¸€äº›åˆå§‹åŒ–æˆ–é”€æ¯çš„æ“ä½œã€‚åœ¨ JUnit 5 ä¸­ï¼Œæœ‰4ä¸ªæ³¨è§£ä½ å¯èƒ½ä¼šç”¨äºå¦‚æ­¤å·¥ä½œï¼š\n\n`@BeforeAll`  \nåªæ‰§è¡Œä¸€æ¬¡ï¼Œæ‰§è¡Œæ—¶æœºæ˜¯åœ¨æ‰€æœ‰æµ‹è¯•å’Œ `@BeforeEach` æ³¨è§£æ–¹æ³•ä¹‹å‰ã€‚\n\n`@BeforeEach`  \nåœ¨æ¯ä¸ªæµ‹è¯•æ‰§è¡Œä¹‹å‰æ‰§è¡Œã€‚\n\n`@AfterEach`  \nåœ¨æ¯ä¸ªæµ‹è¯•æ‰§è¡Œä¹‹åæ‰§è¡Œã€‚\n\n`@AfterAll`  \nåªæ‰§è¡Œä¸€æ¬¡ï¼Œæ‰§è¡Œæ—¶æœºæ˜¯åœ¨æ‰€æœ‰æµ‹è¯•å’Œ `@AfterEach` æ³¨è§£æ–¹æ³•ä¹‹åã€‚\n\nå› ä¸ºæ¡†æ¶ä¼šä¸ºæ¯ä¸ªæµ‹è¯•åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„å®ä¾‹ï¼Œåœ¨ `@BeforeAll`/`@AfterAll` æ–¹æ³•æ‰§è¡Œæ—¶å°šæ— ä»»ä½•æµ‹è¯•å®ä¾‹è¯ç”Ÿã€‚å› æ­¤ï¼Œè¿™ä¸¤ä¸ªæ–¹æ³•å¿…é¡»å®šä¹‰ä¸ºé™æ€æ–¹æ³•ã€‚\n\næ³¨è§£äº†åŒæ ·ä¸€ä¸ªæ³¨è§£çš„ä¸åŒæ–¹æ³•ï¼Œå…¶æ‰§è¡Œæ¬¡åºæ˜¯ä¸å¯é¢„çŸ¥çš„ï¼ŒåŒ…æ‹¬å¯¹ç»§æ‰¿æ¥çš„æ–¹æ³•ä¹Ÿé€‚ç”¨ã€‚è¿™æ˜¯å¼€å‘å›¢é˜Ÿç»è¿‡å®¡æ…æ€è€ƒåçš„å†³å®šï¼Œå³æŠŠå•å…ƒæµ‹è¯•ä¸é›†æˆæµ‹è¯•çš„å…³æ³¨ç‚¹åˆ†å¼€ã€‚é›†æˆæµ‹è¯•å¯èƒ½éœ€è¦æ–¹æ³•é—´æ›´ç´§å¯†çš„åä½œï¼Œä½†ä¸€ä¸ªå•å…ƒæµ‹è¯•ä¸åº”è¯¥å¯¹å…¶ä»–çš„å•å…ƒæµ‹è¯•æœ‰æ‰€ä¾èµ–ã€‚è€Œå¯¹äºé›†æˆæµ‹è¯•â€”â€”ä¹Ÿå«åœºæ™¯æµ‹è¯•â€”â€”çš„æ”¯æŒï¼Œä¹Ÿ[å·²åœ¨å›¢é˜Ÿçš„è®¡åˆ’ä¸­](https://github.com/junit-team/junit5/issues/48)ã€‚\n\né™¤äº†åå­—æœ‰æ‰€ä¸åŒï¼Œè¿™å‡ ä¸ªæ³¨è§£ä¸ JUnit 4 ä¸­çš„æ³¨è§£å·¥ä½œæ–¹å¼å®Œå…¨ä¸€æ ·ã€‚[æ— ç‹¬æœ‰å¶](http://jasmine.github.io/2.1/introduction.html#section-Setup_and_Teardown)ï¼Œ[è·Ÿä¸»æµæ„è§ä¸€è‡´](https://www.relishapp.com/rspec/rspec-core/v/2-2/docs/hooks/before-and-after-hooks)ï¼Œæˆ‘ä¹Ÿè§‰å¾—è¿™ä¸ªæ–°çš„å‘½åä¸èƒ½è¯´æœæˆ‘å…¶å¿…è¦æ€§ã€‚[è¿™ä¸ª issue](https://github.com/junit-team/junit5/issues/163) ä¸‹æœ‰æ›´å¤šçš„è®¨è®ºã€‚\n\n#### ç¦ç”¨æµ‹è¯•\n\nä»Šå„¿æ˜ŸæœŸäº”ï¼ŒæŠ¬å¤´ä¸€çœ‹å·²ç»4ç‚¹åŠï¼Œæ— å¿ƒå·¥ä½œçš„ä½ æƒ³å›å®¶äº†ï¼Ÿå®Œå…¨ç†è§£ï¼Œåœ¨æµ‹è¯•ä¸Šæ€’æ‹ä¸€ä¸ª `@Disabled` æ³¨è§£å³å¯ã€‚~~æœ‰è‰¯å¿ƒçš„è¯~~å†™ä¸ªå¿½ç•¥æµ‹è¯•çš„ç†ç”±æ˜¯æå¥½çš„ï¼Œä¸è¿‡ä¹Ÿå¯ä»¥ä¸å¸¦æ­¤å‚æ•°ã€‚\n\n```java\n@Test \n@Disabled(\"ä½ ä¸«å°±æ˜¯å­˜å¿ƒè·‘ä¸è¿‡çš„æ˜¯ä¸ï¼Ÿï¼\")\nvoid failingTest() {\n    assertTrue(false);\n}\n```\n\n#### æµ‹è¯•ç±»çš„ç”Ÿå‘½å‘¨æœŸ\n\nJUnit å›¢é˜Ÿå‘å¸ƒçš„ç¬¬ä¸€ç‰ˆåŸå‹ä¸­ï¼ŒåŒ…å«äº†ä¸€ä¸ªå¯¹ [æµ‹è¯•ç±»çš„ç”Ÿå‘½å‘¨æœŸ](http://blog.codefx.org/libraries/junit-lambda-prototype/#Lifecycles) çš„æè¿°ï¼Œæœ‰æ„æ€çš„æ˜¯ï¼Œè¿™ä¸ªç‰¹æ€§åœ¨ alpha ç‰ˆæœ¬çš„å‘å¸ƒä¸­æœªè¢«åŠ å…¥ã€‚è¿™ä¸ªç”Ÿå‘½å‘¨æœŸæ¨¡å‹å»ºè®®ï¼Œåœ¨è¢«æµ‹ç±»çš„å¤šä¸ªæµ‹è¯•æ–¹æ³•ä¸­ä½¿ç”¨ä¸€ä¸ªåŒæ ·çš„å®ä¾‹ï¼Œå› ä¸ºè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ”¹å˜å¯¹è±¡çš„çŠ¶æ€ï¼Œè¿›è€Œå®ç°åœ¨å¤šä¸ªæµ‹è¯•æ–¹æ³•ä¸­çš„äº¤äº’ã€‚ï¼ˆæˆ‘ä¹Ÿå†è¯´ä¸€éï¼Œè¿™æ›´åƒæ˜¯ [åœºæ™¯æµ‹è¯•](https://github.com/junit-team/junit5/issues/48) è¦ç®¡çš„äº‹ã€‚ï¼‰\n\næ­£å¦‚æˆ‘åœ¨ç¬¬ä¸€ç‰ˆå…¬æµ‹æ—¶æ‰€è¯´ï¼Œè¿™æ ·çš„ç‰¹æ€§99%çš„åœºæ™¯ä¸‹æ˜¯æœ‰å®³çš„ï¼Œåªæœ‰å¦å¤–1%çš„åœºåˆä¸‹æ‰æœ‰çœŸæ­£çš„ç”¨å¤„ã€‚æˆ‘åªèƒ½è¯´ï¼Œè¿˜å¥½è¿™ä¸ªç‰¹æ€§è¢«æ‘’å¼ƒäº†ã€‚æƒ³æƒ³ä½ çš„å•å…ƒæµ‹è¯•ï¼Œå¦‚æœå®ƒä»¬å¿…é¡»é åœ¨æ–¹æ³•é—´ç»´æŠ¤çŠ¶æ€æ¥å·¥ä½œï¼Œè¿™ç”»é¢ç®€ç›´å¤ªç¾æˆ‘ä¸æ•¢çœ‹ğŸ™ˆã€‚\n\n### æ–­è¨€\n\nå¦‚æœè¯´ `@Test`ã€`@Before...`ã€`@After...` ç­‰æ³¨è§£æ˜¯ä¸€ä¸ªæµ‹è¯•å¥—ä»¶çš„éª¨æ¶ï¼Œé‚£ä¹ˆæ–­è¨€å°±æ˜¯å®ƒçš„å¿ƒè„ã€‚å‡†å¤‡å¥½æµ‹è¯•å®ä¾‹ã€æ‰§è¡Œäº†è¢«æµ‹ç±»çš„æ–¹æ³•ä»¥åï¼Œæ–­è¨€èƒ½ç¡®ä¿ä½ å¾—åˆ°äº†æƒ³è¦çš„ç»“æœã€‚å¦åˆ™ï¼Œå°±è¯´æ˜å½“å‰æµ‹è¯•å¤±è´¥äº†ã€‚\n\n#### å¸¸è§„æ–­è¨€\n\nä¸€èˆ¬çš„æ–­è¨€ï¼Œæ— éæ˜¯æ£€æŸ¥ä¸€ä¸ªå®ä¾‹çš„å±æ€§ï¼ˆæ¯”å¦‚ï¼Œåˆ¤ç©ºä¸åˆ¤éç©ºç­‰ï¼‰ï¼Œæˆ–è€…å¯¹ä¸¤ä¸ªå®ä¾‹è¿›è¡Œæ¯”è¾ƒï¼ˆæ¯”å¦‚ï¼Œæ£€æŸ¥ä¸¤ä¸ªå®ä¾‹å¯¹è±¡æ˜¯å¦ç›¸ç­‰ï¼‰ç­‰ã€‚æ— è®ºå“ªç§æ£€æŸ¥ï¼Œæ–­è¨€æ–¹æ³•éƒ½å¯ä»¥æ¥å—ä¸€ä¸ªå­—ç¬¦ä¸²ä½œä¸ºæœ€åä¸€ä¸ªå¯é€‰å‚æ•°ï¼Œå®ƒä¼šåœ¨æ–­è¨€å¤±è´¥æ—¶æä¾›å¿…è¦çš„æè¿°ä¿¡æ¯ã€‚å¦‚æœæä¾›å‡ºé”™ä¿¡æ¯çš„è¿‡ç¨‹æ¯”è¾ƒå¤æ‚ï¼Œå®ƒä¹Ÿå¯ä»¥è¢«åŒ…è£…åœ¨ä¸€ä¸ª lambda è¡¨è¾¾å¼ä¸­ï¼Œè¿™æ ·ï¼Œåªæœ‰åˆ°çœŸæ­£å¤±è´¥çš„æ—¶å€™ï¼Œæ¶ˆæ¯æ‰ä¼šçœŸæ­£è¢«æ„é€ å‡ºæ¥ã€‚\n\n```java\n\n@Test\nvoid assertWithBoolean() {\n\tassertTrue(true);\n\tassertTrue(this::truism);\n \n\tassertFalse(false, () -> \"Really \" + \"expensive \" + \"message\" + \".\");\n}\n \nboolean truism() {\n\treturn true;\n}\n \n@Test\nvoid assertWithComparison() {\n\tList<String> expected = asList(\"element\");\n\tList<String> actual = new LinkedList<>(expected);\n \n\tassertEquals(expected, actual);\n\tassertEquals(expected, actual, \"Should be equal.\");\n\tassertEquals(expected, actual, () -> \"Should \" + \"be \" + \"equal.\");\n\t\n\tassertNotSame(expected, actual, \"Obviously not the same instance.\");\n}\n```\n\nå¦‚ä½ æ‰€è§ï¼ŒJUnit 5 çš„ API å¹¶æ— å¤ªå¤šå˜åŒ–ã€‚æ–­è¨€æ–¹æ³•çš„å‘½åæ˜¯ä¸€æ ·çš„ï¼Œæ–¹æ³•åŒæ ·æ¥å—ä¸¤ä¸ªå‚æ•°ï¼Œåˆ†åˆ«æ˜¯ä¸€ä¸ªæœŸæœ›å€¼ä¸ä¸€ä¸ªå®é™…å€¼ã€‚\n\næœŸæœ›å€¼ä¸å®é™…å€¼çš„ä¼ å…¥é¡ºåºéå¸¸é‡è¦ï¼Œæ— è®ºæ˜¯å¯¹äºç†è§£æµ‹è¯•çš„å†…å®¹ï¼Œè¿˜æ˜¯ç†è§£å¤±è´¥æ—¶çš„é”™è¯¯ä¿¡æ¯ï¼Œä½†æœ‰æ—¶è¿˜æ˜¯å¾ˆå®¹æ˜“å¼„é”™ï¼Œè¿™ç‚¹å¾ˆå‘ã€‚ä¸è¿‡ä»”ç»†æƒ³æƒ³ï¼Œä¹Ÿæ²¡ä»€ä¹ˆæ›´å¥½çš„åŠæ³•ï¼Œé™¤éä½ è‡ªå·±åˆ›å»ºä¸€ä¸ªæ–°çš„æ–­è¨€æ¡†æ¶ã€‚æ—¢ç„¶å¸‚é¢ä¸Šå·²æœ‰å¯¹åº”çš„äº§å“å¦‚ [Hamcrest](http://hamcrest.org/JavaHamcrest/) (ugh!) å’Œ [AssertJ](http://joel-costigliola.github.io/assertj/) (yeahï¼è¯‘è€…è¡¨ç¤ºï¼šä¸å¤ªæ¸…æ¥šè¿™æ¬¢å‘¼çš„æ¢—åœ¨å“ªé‡Œ)ç­‰ï¼Œå†æµªè´¹æœ‰é™çš„æ—¶é—´å»é€ è½®å­æ˜æ˜¾ä¸å€¼å¾—ã€‚æ¯•ç«Ÿæœ€é‡è¦çš„æ˜¯ä¿è¯ä½ çš„æ–­è¨€åº“ä¸“æ³¨äºä¸€ä»¶äº‹ï¼Œå€Ÿé‰´å·²æœ‰å®ç°å¯ä»¥èŠ‚çœæˆæœ¬ã€‚\n\nå“¦å¯¹äº†ï¼Œå¤±è´¥ä¿¡æ¯ç°åœ¨æ˜¯ä½œä¸ºæœ€åä¼ å…¥çš„å‚æ•°äº†ã€‚æˆ‘å¾ˆå–œæ¬¢è¿™ä¸ªç»†èŠ‚ï¼Œå› ä¸ºï¼Œå®ƒè®©ä½ ä¸“æ³¨äºçœŸæ­£é‡è¦ä¹‹äº‹â€”â€”é‚£ä¸¤ä¸ªéœ€è¢«æ–­è¨€çš„å€¼ã€‚ç”±äºæ‹¥æŠ±äº† Java 8 çš„ç¼˜æ•…ï¼ŒçœŸå€¼æ–­è¨€æ–¹æ³•ç°åœ¨ä¹Ÿæ¥å— [`supplier`](https://docs.oracle.com/javase/8/docs/api/java/util/function/BooleanSupplier.html) å‚æ•°äº†ï¼Œåˆæ˜¯ä¸€ä¸ªæš–å¿ƒçš„å°ç»†èŠ‚ã€‚\n\n#### æ‰©å±•æ–­è¨€\n\né™¤äº†é‚£ç§ä¸€èˆ¬çš„æ£€æŸ¥ç‰¹å®šå®ä¾‹æˆ–å±æ€§çš„æ–­è¨€å¤–ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–ç±»å‹çš„æ–­è¨€ã€‚\n\nè¿™é‡Œè¦è®²çš„ç¬¬ä¸€ä¸ªç”šè‡³éƒ½ä¸æ˜¯ä¸ªçœŸæ­£çš„æ–­è¨€ï¼Œå®ƒåšçš„äº‹å°±æ˜¯å¼ºè¡Œè®©æµ‹è¯•å¤±è´¥ï¼Œå¹¶æä¾›ä¸€ä¸ªå¤±è´¥ä¿¡æ¯ã€‚\n\n```java\n@Test\nvoid failTheTest() {\n\tfail(\"epicly\");\n}\n```\n\nè¿˜æœ‰ `assertAll` æ–¹æ³•ï¼Œå®ƒæ¥å—å¯å˜æ•°é‡çš„æ–­è¨€ä½œä¸ºå‚æ•°ï¼Œå¹¶ä¿è¯å®ƒä»¬å…¨éƒ¨å¾—åˆ°æ‰§è¡Œï¼Œç„¶åå†æŠŠé”™è¯¯ä¿¡æ¯ï¼ˆå¦‚æœæœ‰ï¼‰ä¸€å¹¶æ±‡æŠ¥å‡ºæ¥ã€‚\n\n```java\n@Test\nvoid assertAllProperties() {\n\tAddress address = new Address(\"New City\", \"Some Street\", \"No\");\n \n\tassertAll(\"address\",\n\t\t\t() -> assertEquals(\"Neustadt\", address.city),\n\t\t\t() -> assertEquals(\"IrgendeinestraÃŸe\", address.street),\n\t\t\t() -> assertEquals(\"Nr\", address.number)\n\t);\n}\n```\n\n```\norg.opentest4j.MultipleFailuresError: address (3 failures)\n\texpected: <Neustadt> but was: <New City>\n\texpected: <IrgendeinestraÃŸe> but was: <Some Street>\n\texpected: <Nr> but was: <No>\n```\n\nè¿™ä¸ªç‰¹æ€§åœ¨æ£€æŸ¥å¯¹è±¡çš„å¤šä¸ªå±æ€§å€¼æ—¶éå¸¸æœ‰ç”¨ã€‚æŒ‰ç…§ä¸€èˆ¬çš„åšæ³•ï¼Œæµ‹è¯•åœ¨ç¬¬ä¸€ä¸ªæ–­è¨€å¤±è´¥æ—¶å°±ä¼šæŒ‚æ‰äº†ï¼Œæ­¤æ—¶åªæœ‰ç¬¬ä¸€ä¸ªå‡ºé”™çš„åœ°æ–¹å¾—åˆ°æç¤ºï¼Œè€Œä½ æ— æ³•å¾—çŸ¥å…¶ä»–å€¼çš„æ–­è¨€æ˜¯å¦æˆåŠŸï¼Œåªå¥½å†è·‘ä¸€éæµ‹è¯•ã€‚\n\næœ€åï¼Œæˆ‘ä»¬ç»ˆäºæœ‰äº† `assertThrows` å’Œ `expectThrows` æ–¹æ³•ã€‚ä¸¤è€…å‡ä¼šåœ¨è¢«æµ‹æ–¹æ³•æœªæŠ›å‡ºé¢„æœŸå¼‚å¸¸æ—¶å¤±è´¥ã€‚è€Œåè€…è¿˜ä¼šè¿”å›æŠ›å‡ºçš„å¼‚å¸¸å®ä¾‹ï¼Œä»¥ç”¨äºåç»­çš„éªŒè¯ï¼Œæ¯”å¦‚ï¼Œæ–­è¨€å¼‚å¸¸ä¿¡æ¯åŒ…å«æ­£ç¡®çš„ä¿¡æ¯ç­‰ã€‚\n\n```java\n@Test\nvoid assertExceptions() {\n\tassertThrows(Exception.class, this::throwing);\n \n\tException exception = expectThrows(Exception.class, this::throwing);\n\tassertEquals(\"Because I can!\", exception.getMessage());\n}\n```\n\n### å‡è¨€/åˆ¤å®šï¼ˆAssumptionsï¼‰â€¨\nå‡è¨€/åˆ¤å®šå…è®¸ä½ ä»…åœ¨ç‰¹å®šæ¡ä»¶æ»¡è¶³æ—¶æ‰è¿è¡Œæµ‹è¯•ã€‚è¿™ä¸ªç‰¹æ€§èƒ½å¤Ÿå‡å°‘æµ‹è¯•ç»„ä»¶çš„è¿è¡Œæ—¶é—´å’Œä»£ç é‡å¤ï¼Œç‰¹åˆ«æ˜¯åœ¨å‡è¨€éƒ½ä¸æ»¡è¶³çš„æƒ…å†µä¸‹ã€‚\n\n```java\n\n@Test\nvoid exitIfFalseIsTrue() {\n\tassumeTrue(false);\n\tSystem.exit(1);\n}\n \n@Test\nvoid exitIfTrueIsFalse() {\n\tassumeFalse(this::truism);\n\tSystem.exit(1);\n}\n \nprivate boolean truism() {\n\treturn true;\n}\n \n@Test\nvoid exitIfNullEqualsString() {\n\tassumingThat(\n\t\t\t\"null\".equals(null),\n\t\t\t() -> System.exit(1)\n\t);\n}\n```\n\nå‡è¨€/åˆ¤å®šé€‚ç”¨äºä¸¤ç§æƒ…å½¢ï¼Œè¦ä¹ˆæ˜¯ä½ å¸Œæœ›åœ¨æŸäº›æ¡ä»¶ä¸æ»¡è¶³æ—¶ä¸­æ­¢æµ‹è¯•ï¼Œè¦ä¹ˆæ˜¯ä½ å¸Œæœ›ä»…å½“æŸä¸ªæ¡ä»¶æ»¡è¶³æ—¶æ‰æ‰§è¡Œï¼ˆéƒ¨åˆ†ï¼‰æµ‹è¯•ã€‚ä¸»è¦çš„åŒºåˆ«æ˜¯ï¼Œè¢«ä¸­æ­¢çš„æµ‹è¯•æ˜¯ä»¥è¢«ç¦ç”¨ï¼ˆdisabledï¼‰çš„å½¢å¼è¢«æŠ¥å‘Šï¼Œæ­¤æ—¶æ²¡æœ‰æµ‹è¯•ä»»ä½•å†…å®¹ï¼Œå› ä¸ºæ¡ä»¶å¾—ä¸åˆ°æ»¡è¶³ã€‚\n\n### æµ‹è¯•åµŒå¥—\n\nåœ¨ JUnit 5 ä¸­ï¼ŒåµŒå¥—æµ‹è¯•å‡ ä¹ä¸è´¹å¹ç°ä¹‹åŠ›ã€‚ä½ åªéœ€è¦åœ¨åµŒå¥—çš„ç±»ä¸Šæ·»åŠ  `@Nested` æ³¨è§£ï¼Œç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•å³ä¼šè¢«å¼•æ“æ‰§è¡Œï¼š\n\n```java\n\npackage org.codefx.demo.junit5;\n \nimport org.junit.jupiter.api.BeforeEach;\nimport org.junit.jupiter.api.Nested;\nimport org.junit.jupiter.api.Test;\n \nimport static org.junit.jupiter.api.Assertions.assertEquals;\nimport static org.junit.jupiter.api.Assertions.assertTrue;\n \nclass Nest {\n\t\n\tint count = Integer.MIN_VALUE;\n\t\n\t@BeforeEach\n\tvoid setCountToZero() {\n\t\tcount = 0;\n\t}\n\t\n\t@Test\n\tvoid countIsZero() {\n\t\tassertEquals(0, count);\n\t}\n\t\n\t@Nested\n\tclass CountGreaterZero {\n \n\t\t@BeforeEach\n\t\tvoid increaseCount() {\n\t\t\tcount++;\n\t\t}\n \n\t\t@Test\n\t\tvoid countIsGreaterZero() {\n\t\t\tassertTrue(count > 0);\n\t\t}\n \n\t\t@Nested\n\t\tclass CountMuchGreaterZero {\n \n\t\t\t@BeforeEach\n\t\t\tvoid increaseCount() {\n\t\t\t\tcount += Integer.MAX_VALUE / 2;\n\t\t\t}\n \n\t\t\t@Test\n\t\t\tvoid countIsLarge() {\n\t\t\t\tassertTrue(count > Integer.MAX_VALUE / 2);\n\t\t\t}\n \n\t\t}\n \n\t}\n\t\n}\n```\n\nå¦‚ä½ æ‰€è§ï¼ŒåµŒå¥—ç±»ä¸­çš„ `@BeforeEach`ï¼ˆåŠ `@AfterEach` ï¼‰æ³¨è§£ä¹Ÿå·¥ä½œè‰¯å¥½ã€‚ä¸è¿‡ï¼Œæ„é€ é¡ºåºä¼¼ä¹è¿˜æœªè¢«å†™å…¥æ–‡æ¡£ï¼Œå®ƒä»¬çš„åˆå§‹åŒ–æ¬¡åºæ˜¯ä»å¤–å‘å†…çš„ã€‚è¿™ä¹Ÿè®©ä½ èƒ½å åŠ å¼åœ°ä¸ºå†…éƒ¨ç±»å‡†å¤‡æµ‹è¯•æ•°æ®ã€‚\n\nå¦‚æœåµŒå¥—çš„å†…éƒ¨æµ‹è¯•æƒ³è¦å­˜å–å¤–éƒ¨æµ‹è¯•ç±»çš„å­—æ®µï¼Œé‚£ä¹ˆåµŒå¥—ç±»æœ¬èº«ä¸åº”è¯¥æ˜¯é™æ€çš„ã€‚ä½†è¿™æ ·ä¸€æ¥ä¹Ÿå°±ç¦æ­¢äº†é™æ€æ–¹æ³•çš„ä½¿ç”¨ï¼Œå› è€Œè¿™ç§åœºæ™¯ä¸‹`@BeforeAll` å’Œ `@AfterAll` æ–¹æ³•ä¹Ÿå°±æ— æ³•ä½¿ç”¨äº†ï¼ˆ[è¿˜æ˜¯è¯´ç»ˆæœ‰ä»–æ³•å®ç°ï¼Ÿ](https://github.com/junit-team/junit5/issues/166)ï¼‰\n\nä½ å¯èƒ½æœ‰ç–‘æƒ‘ï¼ŒåµŒå¥—çš„å†…éƒ¨æµ‹è¯•ç±»æœ‰ä»€ä¹ˆç”¨ã€‚ä¸ªäººè€Œè¨€ï¼Œæˆ‘ç”¨å†…éƒ¨ç±»æ¥[æ¸è¿›æµ‹è¯•æ¥å£](https://github.com/CodeFX-org/LibFX/blob/3ec42447a99cbac33642cef35d0e522f7b595435/src/test/java/org/codefx/libfx/collection/tree/stream/StackTreePathTest.java)ï¼Œå…¶ä»–äººåˆ™å¤šç”¨äºä¿æŒæµ‹è¯•ç±»[çŸ­å°ä¸“æ³¨](http://www.petrikainulainen.net/programming/testing/writing-clean-tests-small-is-beautiful/)ã€‚åè€…åŒæ—¶ä¹Ÿæœ‰ä¸€ä¸ªç»å…¸çš„ä¾‹å­æ¥è¯´æ˜ï¼Œ[ä¾‹å­ç”± JUnit å›¢é˜Ÿæä¾›](https://junit-team.github.io/junit5/#nested-tests)ï¼Œå®ƒæµ‹è¯•äº†ä¸€ä¸ªæ ˆï¼š\n\n```java\nclass TestingAStack {\n \n    Stack<Object> stack;\n    boolean isRun = false;\n \n    @Test\n    void isInstantiatedWithNew() {\n        new Stack<Object>();\n    }\n \n    @Nested\n    class WhenNew {\n \n        @BeforeEach\n        void init() {\n            stack = new Stack<Object>();\n        }\n \n        // some tests on 'stack', which is empty\n \n        @Nested\n        class AfterPushing {\n \n            String anElement = \"an element\";\n \n            @BeforeEach\n            void init() {\n                stack.push(anElement);\n            }\n \n            // some tests on 'stack', which has one element...\n \n        }\n    }\n}\n```\n\nåœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæ ˆçš„çŠ¶æ€æ”¹å˜ä¼šåæ˜ åˆ°å†…å±‚çš„æµ‹è¯•ç±»ä¸­ï¼Œå…¶ä¸­å†…éƒ¨ç±»åˆåŸºäºè‡ªèº«çš„åœºæ™¯æ‰§è¡Œäº†ä¸€äº›æµ‹è¯•ã€‚\n\n### æµ‹è¯•å‘½å\n\nJUnit 5 æä¾›äº†ä¸€ä¸ªæ³¨è§£ `@DisplayName`ï¼Œå®ƒç”¨ä»¥ä¸ºå¼€å‘è€…æä¾›æ›´å¯è¯»çš„æµ‹è¯•ç±»å’Œæµ‹è¯•æ–¹æ³•ä¿¡æ¯ã€‚\n\nä¸Šé¢çš„ stack æµ‹è¯•ä¾‹å­åŠ ä¸Šè¯¥æ³¨è§£ä»¥åå°±å˜æˆè¿™æ ·ï¼š\n\n```java\n@DisplayName(\"A stack\")\nclass TestingAStack {\n \n    @Test\n    @DisplayName(\"is instantiated with new Stack()\")\n    void isInstantiatedWithNew() { /*...*/ }\n \n    @Nested\n    @DisplayName(\"when new\")\n    class WhenNew {\n \n        @Test\n        @DisplayName(\"is empty\")\n        void isEmpty() { /*...*/ }\n \n        @Test\n        @DisplayName(\"throws EmptyStackException when popped\")\n        void throwsExceptionWhenPopped() { /*...*/ }\n \n        @Test\n        @DisplayName(\"throws EmptyStackException when peeked\")\n        void throwsExceptionWhenPeeked() { /*...*/ }\n \n        @Nested\n        @DisplayName(\"after pushing an element\")\n        class AfterPushing {\n \n            @Test\n            @DisplayName(\"it is no longer empty\")\n            void isEmpty() { /*...*/ }\n \n            @Test\n            @DisplayName(\"returns the element when popped and is empty\")\n            void returnElementWhenPopped() { /*...*/ }\n \n            @Test\n            @DisplayName(\n                    \"returns the element when peeked but remains not empty\")\n            void returnElementWhenPeeked(){ /*...*/ }\n        }\n    }\n}\n```\n\nè¿™æ˜¯ä¸€ä»½TDDer çœ‹äº†ä¼šæ„ŸåŠ¨ï¼Œ[BDD](http://dannorth.net/introducing-bdd/)er çœ‹äº†ä¼šæµæ³ªçš„æµ‹è¯•ç»“æœè¾“å‡ºã€‚\n\n![](http://7xqu8w.com1.z0.glb.clouddn.com/junit-5-basics-testing-a-stack.png)\n\n\n## å›é¡¾\n\nå·®ä¸å¤šå°±è¿™äº›äº†ï¼Œæ­å–œä½ ç»ˆäºè¯»å®Œäº†ã€‚æˆ‘ä»¬åŒ†åŒ†è¿‡å®Œäº† JUnit 5 çš„åŸºæœ¬ç‰¹æ€§ï¼Œç°åœ¨ï¼Œä½ åº”è¯¥äº†è§£äº†æ‰€æœ‰å†™æµ‹è¯•çš„å¿…å¤‡çŸ¥è¯†äº†ï¼šåŒ…æ‹¬å¦‚ä½•ä¸ºæ–¹æ³•æ·»åŠ ç”Ÿå‘½å‘¨æœŸæ³¨è§£ï¼ˆ`@[Before|After][All|Each]`ã€å¦‚ä½•æ³¨è§£æµ‹è¯•æ–¹æ³•æœ¬èº«ï¼ˆ`@Test`ï¼‰ã€å¦‚ä½•åµŒå¥—æµ‹è¯•ï¼ˆ`@Nested`ï¼‰ã€å¦‚ä½•ç»™æµ‹è¯•ä¸€ä¸ªå¥½ä¿¡æ¯ï¼ˆ`@DisplayName`ï¼‰ï¼Œä½ ä¹Ÿåº”è¯¥èƒ½äº†è§£æ–­è¨€å’Œå‡è¨€åˆ¤å®šæ˜¯å¦‚ä½•å·¥ä½œçš„äº†ï¼ˆåŸºæœ¬ä¸Šä¸å‰ç‰ˆæ— å¼‚ï¼‰ã€‚\n\nä¸è¿‡è¿™å¯è¿˜æ²¡å®Œï¼æˆ‘ä»¬è¿˜æ²¡èŠåˆ° [æµ‹è¯•æ–¹æ³•çš„æ¡ä»¶æ‰§è¡Œ][JUnit 5: Conditions]ï¼Œæ²¡èŠåˆ°éå¸¸é…·çš„ [å‚æ•°æ³¨å…¥][JUnit 5: Injection] ï¼Œä»¥åŠ [JUnit 5 çš„æ‰©å±•æœºåˆ¶][JUnit 5: Extension Model] å’Œ [æ¶æ„ä½“ç³»][JUnit 5: Architecture] å‘¢ã€‚æ”¾å¿ƒï¼Œè¿™çœŸçš„æ˜¯æœ€åäº†ï¼Œè¿™äº›è¯é¢˜æˆ‘ä»¬ä¼šä¸€ä¸ªæœˆåå†èŠï¼Œç°åœ¨ä½ å¯ä»¥å…ˆä¼‘æ¯ä¸€ä¸‹å•¦ã€‚\n\næ•¬è¯·æœŸå¾…ä¸‹é›†ï¼\n\n---\n\n[User guide: M2]: http://junit.org/junit5/docs/5.0.0-M2/user-guide/\n[User guide: Current]: http://junit.org/junit5/docs/current/user-guide/\n[JUnit 5: Setup]: http://blog.linesh.tw/#/posts/2016-09-17-junit5-setup\n[JUnit 5: Basics]: http://blog.linesh.tw/#/posts/2016-09-17-junit5-basics\n[JUnit 5: Architecture]: http://blog.linesh.tw/#/posts/2016-09-17-junit5-architecture\n[JUnit 5: Extension Model]: http://blog.linesh.tw/#/posts/2016-09-17-junit5-extension-model\n[JUnit 5: Conditions]: http://blog.linesh.tw/#/posts/2016-09-17-junit5-conditions\n[JUnit 5: Injection]: http://blog.linesh.tw/#/posts/2016-09-17-junit5-injection\n[JUnit 5: Dynamic Tests]: http://blog.linesh.tw/#/posts/2016-09-17-junit5-dynamic-tests\n"}